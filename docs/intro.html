<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.113">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Stan and R for Pharmacometrics - 1&nbsp; Introduction to Bayesian Methods for Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: 1;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./stancodeblocks.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Bayesian Methods for Inference</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stan and R for Pharmacometrics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/StanPMx/stanpmx.github.io" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">About the Authors</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Chapters</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Bayesian Methods for Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stancodeblocks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Stan</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./poppk.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Bayesian Approach to PK/PD using Stan and Torsten</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logisticregression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Logistic Regression Using <code>brms</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Support</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation.html" class="sidebar-item-text sidebar-link">Installation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logreg_ho_solution.html" class="sidebar-item-text sidebar-link">Logistic Regression Hands-On With Solution</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1.1</span>  Introduction</a></li>
  <li><a href="#statistical-inference" id="toc-statistical-inference" class="nav-link" data-scroll-target="#statistical-inference"><span class="toc-section-number">1.2</span>  Statistical Inference</a>
  <ul>
  <li><a href="#motivating-examples" id="toc-motivating-examples" class="nav-link" data-scroll-target="#motivating-examples"><span class="toc-section-number">1.2.1</span>  Motivating Examples</a>
  <ul>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="toc-section-number">1.2.1.1</span>  Example 1</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2"><span class="toc-section-number">1.2.1.2</span>  Example 2</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#frequentistlikelihoodist-approach" id="toc-frequentistlikelihoodist-approach" class="nav-link" data-scroll-target="#frequentistlikelihoodist-approach"><span class="toc-section-number">1.3</span>  Frequentist/Likelihoodist Approach</a></li>
  <li><a href="#bayesian-approach" id="toc-bayesian-approach" class="nav-link" data-scroll-target="#bayesian-approach"><span class="toc-section-number">1.4</span>  Bayesian Approach</a>
  <ul>
  <li><a href="#bayes-theorem" id="toc-bayes-theorem" class="nav-link" data-scroll-target="#bayes-theorem"><span class="toc-section-number">1.4.1</span>  Bayes’ Theorem</a>
  <ul>
  <li><a href="#prior-distribution" id="toc-prior-distribution" class="nav-link" data-scroll-target="#prior-distribution"><span class="toc-section-number">1.4.1.1</span>  Prior Distribution</a></li>
  <li><a href="#likelihood" id="toc-likelihood" class="nav-link" data-scroll-target="#likelihood"><span class="toc-section-number">1.4.1.2</span>  Likelihood</a></li>
  <li><a href="#marginal-distribution" id="toc-marginal-distribution" class="nav-link" data-scroll-target="#marginal-distribution"><span class="toc-section-number">1.4.1.3</span>  Marginal Distribution</a></li>
  <li><a href="#posterior-distribution" id="toc-posterior-distribution" class="nav-link" data-scroll-target="#posterior-distribution"><span class="toc-section-number">1.4.1.4</span>  Posterior Distribution</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#mcmc" id="toc-mcmc" class="nav-link" data-scroll-target="#mcmc"><span class="toc-section-number">1.5</span>  Markov Chain Monte Carlo</a>
  <ul>
  <li><a href="#mcmc---an-illustration" id="toc-mcmc---an-illustration" class="nav-link" data-scroll-target="#mcmc---an-illustration"><span class="toc-section-number">1.5.1</span>  MCMC - An Illustration</a></li>
  <li><a href="#mcmc-for-our-examples" id="toc-mcmc-for-our-examples" class="nav-link" data-scroll-target="#mcmc-for-our-examples"><span class="toc-section-number">1.5.2</span>  MCMC for Our Examples</a>
  <ul>
  <li><a href="#comparison-with-the-analytical-posterior" id="toc-comparison-with-the-analytical-posterior" class="nav-link" data-scroll-target="#comparison-with-the-analytical-posterior"><span class="toc-section-number">1.5.2.1</span>  Comparison with the Analytical Posterior</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summarytldr" id="toc-summarytldr" class="nav-link" data-scroll-target="#summarytldr"><span class="toc-section-number">1.6</span>  Summary/tl;dr</a></li>
  <li><a href="#appendices" id="toc-appendices" class="nav-link" data-scroll-target="#appendices"><span class="toc-section-number">1.7</span>  Appendices</a>
  <ul>
  <li><a href="#appendix-a" id="toc-appendix-a" class="nav-link" data-scroll-target="#appendix-a"><span class="toc-section-number">1.7.1</span>  Appendix A - More on the Marginal Distribution</a></li>
  <li><a href="#appendix-b" id="toc-appendix-b" class="nav-link" data-scroll-target="#appendix-b"><span class="toc-section-number">1.7.2</span>  Appendix B - Derivation of the Posterior in Our Examples</a></li>
  <li><a href="#appendix-c" id="toc-appendix-c" class="nav-link" data-scroll-target="#appendix-c"><span class="toc-section-number">1.7.3</span>  Appendix C - Derivation of the Posterior Predictive Distribution in Our Examples</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/StanPMx/stanpmx.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Bayesian Methods for Inference</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(collapsibleTree)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magick)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>, <span class="at">base_line_size =</span> <span class="dv">2</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">register_knitr_engine</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1.1</span> Introduction</h2>
<p>This document is is meant to introduce you to the most basic elements of Bayesian inference. It is in no way comprehensive, but it will hopefully give you a platform of understanding so that you can get as much as possible out of this tutorial.</p>
<p>Here are a few references that we’ve found useful in our Bayesian lives:</p>
<ul>
<li><a href="http://www.stat.columbia.edu/~gelman/book/">Bayesian Data Analysis</a></li>
<li><a href="https://xcelab.net/rm/statistical-rethinking/">Statistical Rethinking</a></li>
<li><a href="https://avehtari.github.io/ROS-Examples/index.html">Regression and Other Stories</a></li>
<li><a href="https://storopoli.io/">Jose Storopoli’s</a> slides on <a href="https://github.com/storopoli/Bayesian-Statistics">Bayesian Statistics</a></li>
<li><a href="https://discourse.mc-stan.org/">Stan Discourse</a></li>
</ul>
</section>
<section id="statistical-inference" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="statistical-inference"><span class="header-section-number">1.2</span> Statistical Inference</h2>
<ul>
<li>In any experiment, survey, observational study, or clinical trial, we are using sample data to try to answer some question(s) about the population of interest.</li>
<li>We collect (sample) <em>data</em> <span class="math inline">\(\left(X\right)\)</span> to estimate <em>parameters</em> <span class="math inline">\(\left(\theta\right)\)</span> and perform some sort of inference (point estimation, confidence intervals, hypothesis tests, ) to say something/make decisions about the “population.”</li>
<li>However, learning from the data is complicated by the natural variability of the measurements, so we can’t find the “correct” values of the parameters.</li>
<li>We want to quantify our knowledge/uncertainty about the parameters with point estimates, i.e., “typical” values, and uncertainty estimates such as standard errors, CV%, and confidence intervals.</li>
</ul>
<section id="motivating-examples" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="motivating-examples"><span class="header-section-number">1.2.1</span> Motivating Examples</h3>
<p>We want to estimate the proportion of the population that likes <a href="https://www.tastemade.com/shows/the-scran-line/mountain-dew-cheesecake">Mountain Dew Cheesecake</a>.</p>
<center>
<img src="Images/mt_dew_cheesecake.png" class="img-fluid" width="250">
</center>
<section id="example-1" class="level4" data-number="1.2.1.1">
<h4 data-number="1.2.1.1" class="anchored" data-anchor-id="example-1"><span class="header-section-number">1.2.1.1</span> Example 1</h4>
<p>After collecting <span class="math inline">\(n = 6\)</span> data points where <span class="math inline">\(x = 5\)</span> people liked it, we want to make inferences about the population parameter <span class="math inline">\(\theta\)</span>, the proportion of people in the population that likes Mt. Dew Cheesecake.</p>
</section>
<section id="example-2" class="level4" data-number="1.2.1.2">
<h4 data-number="1.2.1.2" class="anchored" data-anchor-id="example-2"><span class="header-section-number">1.2.1.2</span> Example 2</h4>
<p>After collecting <span class="math inline">\(n = 60\)</span> data points where <span class="math inline">\(x = 50\)</span> people liked it, we want to make inferences about the population parameter <span class="math inline">\(\theta\)</span></p>
</section>
</section>
</section>
<section id="frequentistlikelihoodist-approach" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="frequentistlikelihoodist-approach"><span class="header-section-number">1.3</span> Frequentist/Likelihoodist Approach</h2>
<p>The most common methods for parameter estimation in non-Bayesian paradigms involve some sort of optimization. For this problem, we’ll use <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">maximum likelihood</a>, <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> where we find the value of <span class="math inline">\(\theta\)</span> that maximizes the likelihood<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, or, in other words, we find the value of <span class="math inline">\(\theta\)</span> that maximizes the probability of observing the data that we have observed.</p>
<p>In the above example, we assume the data has a <a href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a> with <span class="math inline">\(n\)</span> trials and probability of success, <span class="math inline">\(\theta\)</span>, i.e.&nbsp;<span class="math inline">\(X \sim Bin(n,\theta)\)</span>. Then we can write out the density<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> <span class="math inline">\(f(x \;| \; \theta)\)</span>, the probability that we would would observe <span class="math inline">\(x\)</span> “successes” out of <span class="math inline">\(n\)</span> trials for a given value of <span class="math inline">\(\theta\)</span> for any value of <span class="math inline">\(x \in \{0, 1, 2, \ldots, n\}\)</span> and <span class="math inline">\(0 \leq \theta \leq 1\)</span>: <span class="math display">\[ \begin{align}
f(x | \theta) &amp;= P(X = x \;| \;\theta) \\
&amp;= {n \choose x}\theta^x(1 - \theta)^{n-x},
\;\; x = 0, \; 1, \; 2, \;\ldots, \; n
\end{align}\]</span></p>
<p>For Example 1 above with <span class="math inline">\(n = 6\)</span>, for <span class="math inline">\(\theta\)</span> values of 0.4 and 0.75, the density of <span class="math inline">\(X\)</span> looks like this:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.40</span>, <span class="fl">0.75</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>binom_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span>n_1, <span class="at">times =</span> <span class="fu">length</span>(probs)), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">theta =</span> <span class="fu">rep</span>(probs, <span class="at">each =</span> n_1 <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbinom</span>(x, n_1, <span class="at">prob =</span> theta))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"x: "</span>, x, <span class="st">"&lt;/br&gt;&lt;/br&gt;density: "</span>, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">round</span>(density, <span class="dv">3</span>)))) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"x"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span>n_1,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span>n_1) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Binomial Density"</span>) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span> </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(binom_data, theta <span class="sc">==</span> probs[<span class="dv">1</span>]),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"P(X = x | \U03B8 = "</span>, probs[<span class="dv">1</span>],<span class="st">")"</span>)),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(binom_data, theta <span class="sc">==</span> probs[<span class="dv">2</span>]),</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"P(X = x | \U03B8 = "</span>, probs[<span class="dv">2</span>],<span class="st">")"</span>)),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>annot_base <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fl">1.0</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">16</span>), </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xref =</span> <span class="st">"paper"</span>, </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yref =</span> <span class="st">"paper"</span>, </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xanchor =</span> <span class="st">"center"</span>, </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yanchor =</span> <span class="st">"bottom"</span>, </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">showarrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.2</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B8 = "</span>, probs[<span class="dv">1</span>])) </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.8</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B8 = "</span>, probs[<span class="dv">2</span>])) </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(p1, p2, <span class="at">titleY =</span> <span class="cn">TRUE</span>, <span class="at">titleX =</span> <span class="cn">TRUE</span>, <span class="at">margin =</span> <span class="fl">0.08</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">annotations =</span> <span class="fu">list</span>(a1, a2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-binomial-densities" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="htmlwidget-7a1cb23b8efe0afef045" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a1cb23b8efe0afef045">{"x":{"data":[{"orientation":"v","width":[0.9,0.9,0.9,0.9,0.9,0.9,0.9],"base":[0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6],"y":[0.046656,0.186624,0.31104,0.27648,0.13824,0.036864,0.004096],"text":["x: 0<\/br><\/br>density: 0.047","x: 1<\/br><\/br>density: 0.187","x: 2<\/br><\/br>density: 0.311","x: 3<\/br><\/br>density: 0.276","x: 4<\/br><\/br>density: 0.138","x: 5<\/br><\/br>density: 0.037","x: 6<\/br><\/br>density: 0.004"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9,0.9,0.9,0.9,0.9,0.9],"base":[0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6],"y":[0.000244140625,0.00439453125,0.032958984375,0.1318359375,0.296630859375,0.35595703125,0.177978515625],"text":["x: 0<\/br><\/br>density: 0","x: 1<\/br><\/br>density: 0.004","x: 2<\/br><\/br>density: 0.033","x: 3<\/br><\/br>density: 0.132","x: 4<\/br><\/br>density: 0.297","x: 5<\/br><\/br>density: 0.356","x: 6<\/br><\/br>density: 0.178"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null}],"layout":{"xaxis":{"domain":[0,0.42],"automargin":true,"type":"linear","autorange":false,"range":[-0.795,6.795],"tickmode":"array","ticktext":[0,1,2,3,4,5,6],"tickvals":[0,1,2,3,4,5,6],"categoryorder":"array","categoryarray":[0,1,2,3,4,5,6],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"y","title":"x","hoverformat":".2f"},"xaxis2":{"domain":[0.58,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.795,6.795],"tickmode":"array","ticktext":[0,1,2,3,4,5,6],"tickvals":[0,1,2,3,4,5,6],"categoryorder":"array","categoryarray":[0,1,2,3,4,5,6],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"y2","title":"x","hoverformat":".2f"},"yaxis2":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0177978515625,0.3737548828125],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"x2","title":"P(X = x | θ = 0.75)","hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.015552,0.326592],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"x","title":"P(X = x | θ = 0.4)","hoverformat":".2f"},"annotations":[{"y":1,"font":{"size":16},"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false,"x":0.2,"text":"θ = 0.4"},{"y":1,"font":{"size":16},"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false,"x":0.8,"text":"θ = 0.75"}],"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.966074191478924,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.42,"y0":0,"y1":1},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.966074191478924,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.58,"x1":1,"y0":0,"y1":1}],"images":[],"margin":{"t":56.381901203819,"r":10.6268161062682,"b":58.4474885844749,"l":62.6982150269822},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":21.2536322125363},"title":{"text":"Binomial Density","font":{"color":"rgba(0,0,0,1)","family":"","size":25.5043586550436},"x":0.5,"xref":"paper"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":2.74874731567645,"font":{"color":"rgba(0,0,0,1)","family":"","size":17.0029057700291}},"hovermode":"closest","barmode":"relative"},"attrs":{"42506752b4a":{"x":{},"y":{},"text":{},"type":"bar"},"425048651fae":{"x":{},"y":{},"text":{},"type":"bar"}},"source":"A","config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.1: Two Binomial Densities</figcaption><p></p>
</figure>
</div>
</div>
<p>But we want to maximize the <em>likelihood</em> function, <span class="math inline">\(\mathcal{L}(\theta \; | \; x)\)</span>. Luckily for us, it is the <strong>same as the density</strong>, but is a function of <span class="math inline">\(\theta\)</span> for a given <span class="math inline">\(x\)</span>, instead of <span class="math inline">\(X\)</span> for a given <span class="math inline">\(\theta\)</span>. That is, <span class="math inline">\(\mathcal{L}(\theta \; | \; x) = f(x \;| \; \theta)\)</span>. For Example 1 with <span class="math inline">\(n = 6\)</span> and <span class="math inline">\(x = 5\)</span> the likelihood is as below <span class="math display">\[\begin{align}
\mathcal{L}(\theta \; | \; x)  &amp;= {n \choose x}\theta^x(1 - \theta)^{n-x} \\
&amp;= {6 \choose 5}\theta^5(1 - \theta)^{6 - 5}, \;\; 0 \leq \theta \leq 1
\end{align}\]</span></p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>(binom_like_plot_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">dbinom</span>(x_1, n_1, <span class="at">prob =</span> theta)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> likelihood)) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"L(\U03B8 | X = "</span>, x_1, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"Binomial Likelihood, n = "</span>, n_1, <span class="st">", X = "</span>, x_1)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-binomial-likelihood" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="intro_files/figure-html/fig-binomial-likelihood-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.2: Binomial likelihood.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The <em>maximum likelihood estimate</em> (MLE), <span class="math inline">\(\hat\theta\)</span>, is the value of <span class="math inline">\(\theta\)</span> that maximizes this function. That is, <span class="math display">\[\hat\theta = \underset{\theta}{\mathrm{argmax}} \;
\mathcal{L}(\theta \; | \; x)\]</span></p>
<p>Intuitively, it is the value of <span class="math inline">\(\theta\)</span> that is “most likely” given the observed data. For example, in our example it doesn’t seem likely that we would observe our data if <span class="math inline">\(\theta = 0.25\)</span>, but it seems more likely that we could observe this data if <span class="math inline">\(\theta = 0.8\)</span> or so.</p>
<p>We also want to quantify the uncertainty of this estimate, typically with a <em>standard error</em>. A larger standard error means we are more uncertain about our estimate than a smaller standard error, and in a sense, the standard error is a measure of the “pointiness” of the likelihood. The (asymptotic) standard error can be calculated as the square root of the diagonals of the inverse of the <a href="https://en.wikipedia.org/wiki/Fisher_information">Fisher information</a> matrix evaluated at the MLE (the <a href="https://en.wikipedia.org/wiki/Observed_information">observed Fisher information</a>. See <a href="http://www.sherrytowers.com/mle_introduction.pdf">here</a> for a more thorough discussion of MLEs, Fisher information, and the form when <span class="math inline">\(\theta\)</span> is a vector). An intuitive explanation of the relationship of the standard errors to the Fisher information matrix is that the standard error is a measure of the curvature of the likelihood. Roughly, more information in the data <span class="math inline">\(\implies\)</span> large negative values in the observed Fisher information matrix (more curvature) <span class="math inline">\(\implies\)</span> smaller values after inversion to get the variance.</p>
<p>This particular example has a simple, closed-form solution, but most of our problems in the PK/PD world require a numerical optimization, typically by some gradient-based method. So for our example, we can do this numerical optimization in R</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>n_2 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>n_2 <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>example_mle_1 <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fl">0.3</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fn =</span> <span class="cf">function</span>(theta, n, x) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">-</span><span class="fu">dbinom</span>(x, n, theta, <span class="at">log =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> n_1, <span class="at">x =</span> x_1, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"Brent"</span>, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">hessian =</span> <span class="cn">TRUE</span>, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>example_mle_2 <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fl">0.3</span>, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fn =</span> <span class="cf">function</span>(theta, n, x) </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">-</span><span class="fu">dbinom</span>(x, n, theta, <span class="at">log =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> n_2, <span class="at">x =</span> x_2, </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"Brent"</span>, </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">hessian =</span> <span class="cn">TRUE</span>, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span>Example, <span class="sc">~</span>MLE, <span class="sc">~</span>SE,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, example_mle_1<span class="sc">$</span>par, <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.double</span>(example_mle_1<span class="sc">$</span>hessian)),</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>, example_mle_2<span class="sc">$</span>par, <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.double</span>(example_mle_2<span class="sc">$</span>hessian))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">"Numerical MLE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Numerical MLE</caption>
 <thead>
  <tr>
   <th style="text-align:center;"> Example </th>
   <th style="text-align:center;"> MLE </th>
   <th style="text-align:center;"> SE </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 0.833 </td>
   <td style="text-align:center;"> 0.152 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> 0.833 </td>
   <td style="text-align:center;"> 0.048 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x_ticks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(example_mle_1<span class="sc">$</span>par, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tick_colors <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x_ticks <span class="sc">==</span> example_mle_1<span class="sc">$</span>par, <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> binom_like_plot_1 <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> example_mle_1<span class="sc">$</span>par, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> example_mle_1<span class="sc">$</span>par, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> <span class="fu">dbinom</span>(x_1, n_1, example_mle_1<span class="sc">$</span>par)),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"n = "</span>, n_1, <span class="st">", X = "</span>, x_1))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">dbinom</span>(x_2, n_2, <span class="at">prob =</span> theta)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> likelihood)) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"L(\U03B8 | X = "</span>, x_2, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"Binomial Likelihood, n = "</span>, n_2, <span class="st">", X = "</span>, x_2)) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> example_mle_2<span class="sc">$</span>par, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> example_mle_2<span class="sc">$</span>par, </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> <span class="fu">dbinom</span>(x_2, n_2, example_mle_2<span class="sc">$</span>par)),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors)) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"n = "</span>, n_2, <span class="st">", X = "</span>, x_2))</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>(ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    ggpubr<span class="sc">::</span><span class="fu">annotate_figure</span>(</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">top =</span> ggpubr<span class="sc">::</span><span class="fu">text_grob</span>(<span class="st">"Binomial Likelihoods with MLE"</span>, </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">24</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/binomial-likelihood-with-mle-1.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Two binomial likelihoods with MLE.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bayesian-approach" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="bayesian-approach"><span class="header-section-number">1.4</span> Bayesian Approach</h2>
<p>Classical methods treat the parameter(s) as fixed and the data random and then find a point estimate and standard error using only information from the data<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. In contrast, Bayesian methods treat the parameter(s) as a random variable and consider the data fixed and then make inferences based on a proper <em>distribution</em>. These methods initially allocate probability to all possible parameter values via a <em>prior distribution</em> and then reallocate probability when new information is gained. Bayesian inference depends on our ability to quantify the <em>posterior distribution</em> of the parameters conditioned on the data. This posterior distribution contains all of our knowledge about <span class="math inline">\(\theta\)</span> (prior knowledge and knowledge obtained from the data).</p>
<section id="bayes-theorem" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="bayes-theorem"><span class="header-section-number">1.4.1</span> Bayes’ Theorem</h3>
<p>The form of the posterior distribution follows from <a href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes’ Theorem</a><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>: <span id="eq-bayes-theorem"><span class="math display">\[\begin{align}
\color{blue}{p\left( \theta | x\right)} &amp;=
\frac{p(x, \theta)}{\color{red}{f\left( x \right)}} \notag \\
&amp;= \frac{\color{green}{f\left( x | \theta\right)}\color{orange}{p\left( \theta
\right)}}{\color{red}{f\left( x \right)}} \notag \\
&amp;= \frac{\color{green}{f\left( x | \theta\right)}\color{orange}{p\left( \theta
\right)}}{\color{red}{\int \limits_{\Theta}f\left( x | \theta\right)
p\left( \theta \right) \mathrm{d}\theta}}
\end{align} \tag{1.1}\]</span></span></p>
<section id="prior-distribution" class="level4" data-number="1.4.1.1">
<h4 data-number="1.4.1.1" class="anchored" data-anchor-id="prior-distribution"><span class="header-section-number">1.4.1.1</span> Prior Distribution</h4>
<p>We begin with the <font color="orange">prior distribution</font> to quantify our knowledge/beliefs about <span class="math inline">\(\theta\)</span> before we collect data. For our examples, we might assume</p>
<ol type="1">
<li><p>a “noninformative” prior distribution<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> and use a <span class="math inline">\(Uniform(0, 1)\)</span> (equivalent to a <span class="math inline">\(Beta(1,1)\)</span><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> distribution for <span class="math inline">\(p(\theta)\)</span>). This is a simple way to express our ignorance about <span class="math inline">\(\theta\)</span>.</p></li>
<li><p>an informative prior that expresses our belief that most people will not like Mt. Dew Cheesecake. We might quantify this with a <span class="math inline">\(Beta(2, 3)\)</span> distribution.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>alpha_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>alpha_2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">01</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df_prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta, <span class="at">prior_1 =</span> <span class="fu">dbeta</span>(theta, alpha_1, beta_1),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior_2 =</span> <span class="fu">dbeta</span>(theta, alpha_2, beta_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(prior_1, prior_2), <span class="at">names_to =</span> <span class="st">"example"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(example)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>(prior_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_prior, <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value, </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">color =</span> example)) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8)"</span>)) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Prior"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"prior_1"</span>, <span class="st">"prior_2"</span>),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Uniform (Beta(1, 1))"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Informative (Beta(2, 3))"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-beta-priors" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="intro_files/figure-html/fig-beta-priors-1.png" class="img-fluid figure-img" width="1056"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.3: Two beta priors.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="likelihood" class="level4" data-number="1.4.1.2">
<h4 data-number="1.4.1.2" class="anchored" data-anchor-id="likelihood"><span class="header-section-number">1.4.1.2</span> Likelihood</h4>
<p>The <font color="green">likelihood</font> is the same (see <a href="#fig-binomial-likelihood">Figure&nbsp;<span>1.2</span></a>) as we had when we were using optimization methods (recall that <span class="math inline">\(\mathcal{L}(\theta \; | \; x) = f(x \;| \; \theta)\)</span>).</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_likelihood <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood_1 =</span> <span class="fu">dbinom</span>(x_1, n_1, <span class="at">prob =</span> theta),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood_2 =</span> <span class="fu">dbinom</span>(x_2, n_2, <span class="at">prob =</span> theta)) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(likelihood_1, likelihood_2), <span class="at">names_to =</span> <span class="st">"example"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(example)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plot_likelihood <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_likelihood, <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">color =</span> example)) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"f(x | (\U03B8) = L(\U03B8 | X)"</span>)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Likelihood"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"likelihood_1"</span>, <span class="st">"likelihood_2"</span>),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"purple"</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"x = "</span>, x_1, <span class="st">", n = "</span>, n_1),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_c</span>(<span class="st">"x = "</span>, x_2, <span class="st">", n = "</span>, n_2)))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>plot_likelihood</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/likelihoods-1.png" class="img-fluid figure-img" width="1056"></p>
<p></p><figcaption class="figure-caption">Unnormalized Likelihoods.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>One thing to notice for each of these likelihoods is that they do not integrate to 1<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>, one of the requirements for a function to be a probability distribution. However, the likelihood can be normalized to integrate to 1 by multiplying by a constant. This will be touched upon again in the section on <a href="#marginal-distribution">marginal distributions</a> and in <a href="#appendix-a">Appendix A</a>, and all future plots will plot a scaled likelihood for visual purposes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>like_binom <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, n, x) <span class="fu">dbinom</span>(x, n, theta)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>integral_1 <span class="ot">&lt;-</span> <span class="fu">integrate</span>(like_binom, <span class="at">n =</span> n_1, <span class="at">x =</span> x_1, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)<span class="sc">$</span>value</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>integral_2 <span class="ot">&lt;-</span> <span class="fu">integrate</span>(like_binom, <span class="at">n =</span> n_2, <span class="at">x =</span> x_2, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)<span class="sc">$</span>value</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span>Example, <span class="sc">~</span>Integral,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1"</span>, integral_1,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2"</span>, integral_2) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">"Likelihood Integrals"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-likelihood-integrals" class="anchored">

<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Table&nbsp;1.1:  Likelihood Integrals </caption>
 <thead>
  <tr>
   <th style="text-align:center;"> Example </th>
   <th style="text-align:center;"> Integral </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 0.143 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> 0.016 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Regardless, the likelihood is a key part of Bayes’ Theorem and contains the information about <span class="math inline">\(\theta\)</span> obtained from the data.</p>
</section>
<section id="marginal-distribution" class="level4" data-number="1.4.1.3">
<h4 data-number="1.4.1.3" class="anchored" data-anchor-id="marginal-distribution"><span class="header-section-number">1.4.1.3</span> Marginal Distribution</h4>
<p>Consider the case where <span class="math inline">\(X\)</span> has the sampling density <span class="math inline">\(f(x \;|\; \theta)\)</span> and <span class="math inline">\(\theta\)</span> is a random variable with density <span class="math inline">\(p(\theta)\)</span>. Then the joint density of <span class="math inline">\(X\)</span> and <span class="math inline">\(\theta\)</span> is <span class="math display">\[f(x, \; \theta) = f(x \;|\; \theta) \; p(\theta),\]</span> which you will recognize as the numerator in <a href="#eq-bayes-theorem">Equation&nbsp;<span>1.1</span></a>. The <font color="red">marginal distribution</font><a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> of <span class="math inline">\(X\)</span> is then <span id="eq-marginal-distribution"><span class="math display">\[\begin{align}
f(x) &amp;= \int \limits_{\Theta}f(x, \; \theta) \; \mathrm{d}\theta \notag \\
&amp;= \int \limits_{\Theta}f\left( x | \theta\right) p\left( \theta \right)
\mathrm{d}\theta
\end{align} \tag{1.2}\]</span></span></p>
<p>That is, the marginal density of <span class="math inline">\(X\)</span> is equal to the conditional sampling density of <span class="math inline">\(X\)</span> averaged over all possible values of <span class="math inline">\(\theta\)</span>. It can also be thought of as a description of the predictions we would make for <span class="math inline">\(X\)</span> given only our prior knowledge, which is why this is sometimes called the “prior predictive distribution”<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>. See <a href="#appendix-a">Appendix A</a> for more discussion on the marginal distribution.</p>
<p>In practice, the marginal distribution is often analytically intractable, and it is often just cast aside so that we have the posterior distribution <em>up to a constant</em>: <span id="eq-up-to-constant"><span class="math display">\[\begin{align}
\color{blue}{p( \theta \; | \; x)} &amp;=
\frac{\color{green}{f( x \; | \; \theta)}\; \color{orange}{p( \theta )}}
{\color{red}{f\left( x \right)}} \notag \\
&amp;\propto \color{green}{f( x \; | \; \theta)}\; \color{orange}{p( \theta )}
\end{align} \tag{1.3}\]</span></span></p>
<p>This inability to find a closed-form for the marginal distribution is not a problem. Modern computational methods such as <a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">Markov Chain Monte Carlo</a> (MCMC) allow us to sample from the posterior in such a way that the sample represents the true posterior distribution arbitrarily closely, and we can perform our inference based on this sample.</p>
</section>
<section id="posterior-distribution" class="level4" data-number="1.4.1.4">
<h4 data-number="1.4.1.4" class="anchored" data-anchor-id="posterior-distribution"><span class="header-section-number">1.4.1.4</span> Posterior Distribution</h4>
<p>The <font color="blue">posterior distribution</font> (See <a href="#appendix-b">Appendix B</a> for a derivation of the posterior for our examples) is the key to all Bayesian inference. It combines the prior distribution and the likelihood and contains all of the available information about <span class="math inline">\(\theta\)</span> (prior knowledge and information obtained from the data):</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_all <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_1_1 =</span> <span class="fu">dbeta</span>(theta, alpha_1 <span class="sc">+</span> x_1, beta_1 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_1_2 =</span> <span class="fu">dbeta</span>(theta, alpha_1 <span class="sc">+</span> x_2, beta_1 <span class="sc">+</span> n_2 <span class="sc">-</span> x_2),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_2_1 =</span> <span class="fu">dbeta</span>(theta, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_2_2 =</span> <span class="fu">dbeta</span>(theta, alpha_2 <span class="sc">+</span> x_2, beta_2 <span class="sc">+</span> n_2 <span class="sc">-</span> x_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"posterior"</span>), <span class="at">names_to =</span> <span class="st">"example"</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df_prior, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            df_likelihood) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>df_all <span class="sc">%&gt;%</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"prior_2"</span>, <span class="st">"likelihood_1"</span>, <span class="st">"posterior_2_1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">if_else</span>(example <span class="sc">==</span> <span class="st">"likelihood_1"</span>, value<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>n_1), value)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value, <span class="at">group =</span> example, <span class="at">color =</span> example)) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"prior_2"</span>, <span class="st">"likelihood_1"</span>, <span class="st">"posterior_2_1"</span>),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"green4"</span>, <span class="st">"blue"</span>),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Prior"</span>, <span class="st">"Likelihood"</span>, <span class="st">"Posterior"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/posterior-plot-1.png" class="img-fluid figure-img" width="1056"></p>
<p></p><figcaption class="figure-caption">Posterior as a combination of the likelihood and prior.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Once we have our posterior distribution, we can make similar inferences as in frequentist inference:</p>
<ul>
<li>Point estimates - We have a proper <em>distribution</em> now, so we can report the posterior <font color="red">mean</font>, <font color="purple">median</font>, or <font color="black">mode</font> ( 0.636, 0.645, and 0.667, respectively).</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>posterior_point_estimates <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>type, <span class="sc">~</span>value,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mean"</span>, (alpha_2 <span class="sc">+</span> x_1)<span class="sc">/</span>(alpha_2 <span class="sc">+</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"median"</span>, <span class="fu">qbeta</span>(<span class="fl">0.5</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mode"</span>, (alpha_2 <span class="sc">+</span> x_1 <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">/</span>(alpha_2 <span class="sc">+</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1 <span class="sc">-</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbeta</span>(value, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>(p_posterior_with_point_estimates <span class="ot">&lt;-</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> posterior_point_estimates, </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> value, <span class="at">yend =</span> density,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> type),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.15</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Point Estimate"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"mode"</span>),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>, <span class="st">"Mode"</span>),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"black"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/posterior-point-estimates-1.png" class="img-fluid figure-img" width="1056"></p>
<p></p><figcaption class="figure-caption">Posterior point estimates.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Standard deviation (analogous to a standard error) - for our example the standard deviation is 0.139</li>
<li>Even better, we can make interval estimates, e.g.credible intervals, with a natural probabilistic interpretation:
<ul>
<li>“There is a 95% chance that the true proportion of people who like Mt. Dew cheesecake is between 0.348 and 0.878.”</li>
<li>“There is an 82.81% chance that the true proportion of people who like Mt. Dew cheesecake is at least 0.5.”</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>interval_base <span class="ot">&lt;-</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">c</span>(<span class="fu">qbeta</span>(<span class="fl">0.025</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">qbeta</span>(<span class="fl">0.975</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1)),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">example =</span> <span class="st">"posterior_2_1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">dbeta</span>(theta, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(theta) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>x_ticks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(<span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1), </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>tick_colors <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x_ticks <span class="sc">%in%</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                               alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1), </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>p_ci <span class="ot">&lt;-</span> interval_base <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">between</span>(theta, </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">qbeta</span>(<span class="fl">0.025</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1), </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">qbeta</span>(<span class="fl">0.975</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1))),</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"95% credible interval"</span>) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors))</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>p_gt_50 <span class="ot">&lt;-</span> interval_base <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">between</span>(theta, <span class="fl">0.50</span>, <span class="dv">1</span>)),</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"P(\U03B8 &gt; 0.50 | X = 5)"</span>) <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>p_ci <span class="sc">+</span> p_gt_50</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/interval-plots-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>We can also look at the <em>posterior predictive distribution</em> (See <a href="#appendix-c">Appendix C</a> for a derivation of the posterior predictive distribution for our examples). This is the distribution of possible unobserved values conditional on our observed values. For example, we could look at the density for a future observation, <span class="math inline">\(x^*\)</span>, for different future values of <span class="math inline">\(n, n^*\)</span>.</li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>n_star <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>(p_analytical_ppd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x_star =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>n_star[<span class="dv">1</span>], <span class="dv">0</span><span class="sc">:</span>n_star[<span class="dv">2</span>]),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">n_star =</span> <span class="fu">c</span>(<span class="fu">rep</span>(n_star[<span class="dv">1</span>], <span class="at">times =</span> n_star[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rep</span>(n_star[<span class="dv">2</span>], <span class="at">times =</span> n_star[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> extraDistr<span class="sc">::</span><span class="fu">dbbinom</span>(x_star, n_star, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                       alpha_2 <span class="sc">+</span> x, beta_2 <span class="sc">+</span> n <span class="sc">-</span> x)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_star, <span class="at">y =</span> density),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$x^*$"</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star)) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$p(x^* | </span><span class="sc">\\</span><span class="st">; x) = P(X^*= x^* | </span><span class="sc">\\</span><span class="st">; x)"</span>)) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Posterior Predictive Density"</span>) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n_star, <span class="at">scales =</span> <span class="st">"free_x"</span>, </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(n<span class="sc">^</span><span class="st">"*"</span> <span class="sc">==</span> .(n_star))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/posterior-predictive-plot-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="mcmc" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="mcmc"><span class="header-section-number">1.5</span> Markov Chain Monte Carlo</h2>
<p>As mentioned in the <a href="#marginal-distribution">section on marginal distributions</a>, we often have an analytically intractable marginal distribution, which means we cannot get a closed-form solution for the posterior distribution<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. Markov Chain Monte Carlo (MCMC) methods allow us to sample from the posterior distribution, and we can perform our inference based on numerical integration of the sample, rather than analytical integration when the closed-form is known.</p>
<p>Traditional Monte Carlo methods include the <a href="https://en.wikipedia.org/wiki/Gibbs_sampling">Gibbs sampler</a> and <a href="https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm">Metropolis-Hastings</a>. These methods are fast and easy-to-implement, but often lead to inefficient sampling from the posterior. <a href="https://mc-stan.org/">Stan</a><a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> implements a more modern method called the <a href="https://arxiv.org/abs/1111.4246">No U-Turn Sampler</a> (NUTS) that is itself an extension of <a href="https://en.wikipedia.org/wiki/Hamiltonian_Monte_Carlo">Hamiltonian Monte Carlo</a>. While more computationally intensive than Gibbs sampling or Metropolis-Hastings, it samples more efficiently from the posterior than those more traditional methods.</p>
<section id="mcmc---an-illustration" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="mcmc---an-illustration"><span class="header-section-number">1.5.1</span> MCMC - An Illustration</h3>
<p>Let’s assume we know the posterior density up to a constant, as in <a href="#eq-up-to-constant">Equation&nbsp;<span>1.3</span></a>):</p>
<div class="cell" data-hash="intro_cache/html/mcmc-illustration-truth_9a4e207f71b8c7b54f792ee889b2d5b3">
<div class="cell-output-display">
<p><img src="intro_files/figure-html/mcmc-illustration-truth-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Since we don’t have the marginal distribution, we can’t analytically integrate our posterior, but we can sample from it using MCMC methods:</p>
<p><video src="Videos/samples_falling_drops.mp4" width="600" height="450" controls=""><a href="Videos/samples_falling_drops.mp4">Video</a></video></p>
<p>In practice we use multiple chains to sample from the target distribution:</p>
<div class="cell" data-layout-align="center" data-hash="intro_cache/html/gif-4-chains_b8ebe5058da045a41b63bd0217acfcd1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- time series</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>static_tsplot <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Chain =</span> <span class="st">"chain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> theta, <span class="at">group =</span> Chain, <span class="at">color =</span> Chain)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">"Chain"</span>, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Chain"</span>, <span class="at">x =</span> <span class="st">"Iteration"</span>, <span class="at">y =</span> <span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Chain, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">labeller =</span> label_both)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># animate</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>animated_tsplot <span class="ot">&lt;-</span> static_tsplot <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(<span class="at">along =</span> iteration, </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">max</span>(df<span class="sc">$</span>iteration) <span class="sc">+</span> <span class="dv">50</span>))) </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>a_gif <span class="ot">&lt;-</span> <span class="fu">animate</span>(animated_tsplot,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">600</span>, </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- histogram</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>static_hist <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Chain =</span> <span class="st">"chain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accumulate</span>(<span class="sc">~</span> <span class="fu">bind_rows</span>(.x, .y)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"frame"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frame =</span> <span class="fu">as.integer</span>(frame)) <span class="sc">%&gt;%</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">fill =</span> Chain)) <span class="sc">+</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="co">#aes(y = ..density..), </span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">15</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\U03B8"</span>, <span class="at">fill =</span> <span class="st">"Chain"</span>) <span class="sc">+</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Chain, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">labeller =</span> label_both) </span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co"># animate</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>anim_hist <span class="ot">&lt;-</span> static_hist <span class="sc">+</span> </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_manual</span>(frame) <span class="sc">+</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">"linear"</span>) <span class="sc">+</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_fade</span>() <span class="sc">+</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exit_fade</span>()</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>b_gif <span class="ot">&lt;-</span> <span class="fu">animate</span>(anim_hist,</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">600</span>, </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>a_mgif <span class="ot">&lt;-</span> <span class="fu">image_read</span>(a_gif)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>b_mgif <span class="ot">&lt;-</span> <span class="fu">image_read</span>(b_gif)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- put side-by-side</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>new_gif <span class="ot">&lt;-</span> <span class="fu">image_append</span>(<span class="fu">c</span>(a_mgif[<span class="dv">1</span>], b_mgif[<span class="dv">1</span>]))</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">min</span>(<span class="fu">length</span>(a_mgif))){</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">image_append</span>(<span class="fu">c</span>(a_mgif[i], b_mgif[i]))</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  new_gif <span class="ot">&lt;-</span> <span class="fu">c</span>(new_gif, combined)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>new_gif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="Videos/new_gif.gif" class="img-fluid"></p>
<p>When we have collected all of our samples, we combine the chains, and the resulting samples should be distributed according to the true posterior:</p>
<div class="cell" data-layout-align="center" data-hash="intro_cache/html/mcmc-illustration-hist_851437f6f1dd796056e6f4630b1fe6df">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_hist</span>(samples<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">freq =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> data_1, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/mcmc-illustration-hist-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Samples overlayed with the true distribution.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mcmc-for-our-examples" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="mcmc-for-our-examples"><span class="header-section-number">1.5.2</span> MCMC for Our Examples</h3>
<p>Our examples are very simple and have a simple closed form for the posterior distribution (see <a href="#appendix-b">Appendix B</a>) and posterior predictive distribution (see <a href="#appendix-c">Appendix C</a>). But let’s imagine the marginal distribution was intractable, and we weren’t able to find the closed form for the posterior. We’ll write the model in Stan and then sample from the posterior.</p>
<div class="cell" data-output.var="model_beta_binomial" data-hash="intro_cache/html/stan-model_4498a0a0a897b62a8aef7357da3f4865">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; x; <span class="co">// observed positive responses</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = x&gt; n; <span class="co">// number of responses</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; alpha; <span class="co">// Value of alpha for the prior distribution</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; beta;  <span class="co">// Value of beta for the prior distribution</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n_new;               <span class="co">// length of new n values you want to simulate for </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[n_new] <span class="dt">int</span> n_star; <span class="co">// Number of future respondents for posterior predictions</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>, <span class="kw">upper</span> = <span class="dv">1</span>&gt; theta;</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  theta ~ beta(alpha, beta);</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  x ~ binomial(n, theta);</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span>{</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[n_new] <span class="dt">int</span> x_star = binomial_rng(n_star, theta); </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">6</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="dv">2</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">beta =</span> <span class="dv">3</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_new =</span> <span class="dv">2</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_star =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> model_beta_binomial<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> stan_data,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">refresh =</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.0 seconds.
Chain 2 finished in 0.0 seconds.
Chain 3 finished in 0.0 seconds.
Chain 4 finished in 0.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.0 seconds.
Total execution time: 1.5 seconds.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> <span class="fu">summarize_draws</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                           mean, median, sd, <span class="at">pr_gt_half =</span> <span class="sc">~</span> <span class="fu">mean</span>(. <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">~</span><span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), rhat,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                           ess_bulk, ess_tail)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can perform inference using our samples. We can look at the full posterior distributions with either histograms or density plots:</p>
<div class="cell" data-layout-align="center" data-hash="intro_cache/html/sample-posterior-distribution_994239ced0f3482fefb20fed718a962c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">color_scheme_set</span>(<span class="st">"blue"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>post_hist <span class="ot">&lt;-</span> <span class="fu">mcmc_hist</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">freq =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>post_dens <span class="ot">&lt;-</span> <span class="fu">mcmc_dens</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>)) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>post_hist <span class="sc">/</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  post_dens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/sample-posterior-distribution-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>We can also make similar inferences as before:</p>
<ul>
<li>Point estimates - for these samples, the posterior <font color="red">mean</font> and <font color="purple">median</font> are 0.634 and 0.643, respectively.</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="intro_cache/html/posterior-inference_63395358f3924824002b0062b0a08b54">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>post_dens <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> summary <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(mean, median) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename_all</span>(str_to_title) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(Mean<span class="sc">:</span>Median, <span class="at">names_to =</span> <span class="st">"Estimate"</span>), </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> Estimate),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.15</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Point Estimate"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"purple"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/posterior-inference-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The posterior standard deviation for <span class="math inline">\(\theta\)</span> is 0.137.</li>
<li>Interval estimates
<ul>
<li>95% credible interval - “There is a 95% chance that the true proportion of people who like Mt. Dew cheesecake is between 0.341 and 0.869.”</li>
<li>“There is an 82.6% chance that the true proportion of people who like Mt. Dew cheesecake is at least 0.5.”</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center" data-hash="intro_cache/html/sample-interval-plots_e8e9f581315cf97fcd0459d8e914575b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x_ticks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(summary<span class="sc">$</span>q2<span class="fl">.5</span>, summary<span class="sc">$</span>q97<span class="fl">.5</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>tick_colors <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x_ticks <span class="sc">%in%</span> <span class="fu">c</span>(summary<span class="sc">$</span>q2<span class="fl">.5</span>, summary<span class="sc">$</span>q97<span class="fl">.5</span>), </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>sample_ci <span class="ot">&lt;-</span> <span class="fu">mcmc_areas</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">point_est =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"95% credible interval"</span>) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> x_ticks,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>)),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">breaks =</span> <span class="st">"theta"</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">limits =</span> <span class="st">"theta"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"theta"</span> <span class="ot">=</span> <span class="st">""</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>blah <span class="ot">&lt;-</span> <span class="fu">mcmc_dens</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"P(\U03B8 &gt; 0.50 | X = 5)"</span>) <span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>blah_d <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(blah)<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>sample_gt_half <span class="ot">&lt;-</span> blah <span class="sc">+</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> <span class="fu">subset</span>(blah_d, x <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"blue"</span>, </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.25</span>)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>sample_ci <span class="sc">+</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  sample_gt_half</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/sample-interval-plots-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<p>We can look at the posterior predictive distribution<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> for <span class="math inline">\(n^* = 6\)</span> and <span class="math inline">\(n^* = 10\)</span>:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(p_sample_ppd <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"draws_df"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(x_star[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_star =</span> stan_data<span class="sc">$</span>n_star[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_star, <span class="at">group =</span> n_star, <span class="at">y =</span> ..prop..)) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$x^*$"</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(stan_data<span class="sc">$</span>n_star),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(stan_data<span class="sc">$</span>n_star)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$p(x^* | </span><span class="sc">\\</span><span class="st">; x) = P(X^*= x^* | </span><span class="sc">\\</span><span class="st">; x)"</span>)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Posterior Predictive Density"</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n_star, <span class="at">scales =</span> <span class="st">"free_x"</span>, </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(n<span class="sc">^</span><span class="st">"*"</span> <span class="sc">==</span> .(n_star))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/sample-ppd-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<section id="comparison-with-the-analytical-posterior" class="level4" data-number="1.5.2.1">
<h4 data-number="1.5.2.1" class="anchored" data-anchor-id="comparison-with-the-analytical-posterior"><span class="header-section-number">1.5.2.1</span> Comparison with the Analytical Posterior</h4>
<p>To compare the true, analytical posterior with the sampled posterior we can look at the full densities:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/posterior-comparison-density-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<p>and posterior parameter and quantile estimates:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mcmc_estimates <span class="ot">&lt;-</span> summary <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(mean, median, sd, <span class="fu">starts_with</span>(<span class="st">"q"</span>)), </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"MCMC"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Variable, MCMC) </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>analytical_estimates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Variable =</span> mcmc_estimates<span class="sc">$</span>Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Analytical =</span> <span class="fu">case_when</span>(Variable <span class="sc">==</span> <span class="st">"mean"</span> <span class="sc">~</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                  (alpha_2 <span class="sc">+</span> x_1)<span class="sc">/</span>(alpha_2 <span class="sc">+</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"median"</span> <span class="sc">~</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">qbeta</span>(<span class="fl">0.5</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"sd"</span> <span class="sc">~</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">sqrt</span>((alpha_2 <span class="sc">+</span> x_1)<span class="sc">*</span>(beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1)<span class="sc">/</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                                         ((alpha_2 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(alpha_2 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">+</span> <span class="dv">1</span>))),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"q2.5"</span> <span class="sc">~</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">qbeta</span>(<span class="fl">0.025</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"q97.5"</span> <span class="sc">~</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">qbeta</span>(<span class="fl">0.975</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> analytical_estimates <span class="sc">%&gt;%</span> </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(mcmc_estimates, <span class="at">by =</span> <span class="st">"Variable"</span>) </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>estimates <span class="sc">%&gt;%</span> </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">3</span>),</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">Variable =</span> <span class="fu">case_when</span>(Variable <span class="sc">==</span> <span class="st">"mean"</span> <span class="sc">~</span> <span class="st">"Mean"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"median"</span> <span class="sc">~</span> <span class="st">"Median"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"sd"</span> <span class="sc">~</span> <span class="st">"Std. Dev."</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"q2.5"</span> <span class="sc">~</span> <span class="st">"2.5th percentile"</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"q97.5"</span> <span class="sc">~</span> <span class="st">"97.5th percentile"</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kbl(caption = "&lt;center&gt;Posterior Estimates for &amp;theta;&lt;center&gt;") %&gt;%</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">"Posterior Estimates for \U03B8"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Estimate"</span> <span class="ot">=</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Posterior Estimates for θ</caption>
 <thead>
<tr>
<th style="empty-cells: hide;" colspan="1"></th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">Estimate</div></th>
</tr>
  <tr>
   <th style="text-align:left;"> Variable </th>
   <th style="text-align:right;"> Analytical </th>
   <th style="text-align:right;"> MCMC </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Mean </td>
   <td style="text-align:right;"> 0.636 </td>
   <td style="text-align:right;"> 0.634 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Median </td>
   <td style="text-align:right;"> 0.645 </td>
   <td style="text-align:right;"> 0.643 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Std. Dev. </td>
   <td style="text-align:right;"> 0.139 </td>
   <td style="text-align:right;"> 0.137 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2.5th percentile </td>
   <td style="text-align:right;"> 0.348 </td>
   <td style="text-align:right;"> 0.341 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 97.5th percentile </td>
   <td style="text-align:right;"> 0.878 </td>
   <td style="text-align:right;"> 0.869 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>and the posterior predictive densities:</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(p_sample_ppd)<span class="sc">$</span>data[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"MCMC"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(p_analytical_ppd)<span class="sc">$</span>data[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Analytical"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(d1, d2) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y, type) <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_star =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(n_star[<span class="dv">1</span>], <span class="at">times =</span> n_star[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">rep</span>(n_star[<span class="dv">2</span>], <span class="at">times =</span> n_star[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span>)), <span class="at">times =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">group =</span> type, <span class="at">fill =</span> type),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$x^*$"</span>),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star)) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Analytical"</span>, <span class="st">"MCMC"</span>),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$p(x^* | </span><span class="sc">\\</span><span class="st">; x) = P(X^*= x^* | </span><span class="sc">\\</span><span class="st">; x)"</span>)) <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Posterior Predictive Density"</span>) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n_star, <span class="at">scales =</span> <span class="st">"free_x"</span>, </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(n<span class="sc">^</span><span class="st">"*"</span> <span class="sc">==</span> .(n_star)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="intro_files/figure-html/posterior-comparison-ppd-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<p>You can see that all posterior quantities are similar between the analytical solutions and those estimated through MCMC.</p>
</section>
</section>
</section>
<section id="summarytldr" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="summarytldr"><span class="header-section-number">1.6</span> Summary/tl;dr</h2>
<ul>
<li><p>Classical methods find point estimates through optimization of some objective function (often some function of the likelihood) and quantify uncertainty by examining the curvature of the likelihood at the point estimate.</p></li>
<li><p>Bayesian methods quantify our knowledge about the parameter(s) with a <em>distribution</em>. From this distribution, we can obtain point estimates, uncertainty estimates, and make predictions for future data.</p></li>
<li><p>The posterior distribution is a combination of our prior distribution and the data and contains all of our knowledge about the parameter(s).</p></li>
<li><p>The likelihood contains all of the information from the data.</p></li>
<li><p>The use of the prior distribution can range from being a nuisance that serves simply as a catalyst that allows us to express uncertainty via Bayes’theorem to a means to stabilize the sampling algorithm to actually incorporating knowledge about the parameter(s) before collecting data.</p></li>
<li><p>We often can’t get the posterior distribution in closed-form, but we can generally use Markov Chain Monte Carlo methods to obtain a sample that approximates the posterior.</p></li>
<li><p>Stan is a great tool for performing the MCMC sampling.</p></li>
</ul>
</section>
<section id="appendices" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="appendices"><span class="header-section-number">1.7</span> Appendices</h2>
<section id="appendix-a" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="appendix-a"><span class="header-section-number">1.7.1</span> Appendix A - More on the Marginal Distribution</h3>
<p>While the marginal distribution is often analytically intractable, there are some cases where we can find the closed form. For our examples, we have assumed <span class="math display">\[\begin{align}
X|\theta &amp;\sim Binomial(n, \; \theta) \\
\theta &amp;\sim Beta(\alpha, \; \beta)
\end{align}\]</span> Then <span id="eq-beta-binomial"><span class="math display">\[\begin{align}
f(x) &amp;= \int \limits_{\Theta} p\left( x, \; \theta \right) \; \mathrm{d}\theta \\
&amp;= \int \limits_{\Theta}f\left( x | \theta\right) p\left( \theta \right) \;
\mathrm{d}\theta  \notag \\
&amp;= \int_0^1 {n \choose x}\theta^x(1 - \theta)^{n-x}
\frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\Gamma(\beta)}
\theta^{\alpha - 1}(1 - \theta)^{\beta - 1} \; \mathrm{d}\theta \notag \\
&amp;= {n \choose x} \frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha) \; \Gamma(\beta)}
\frac{\Gamma(\alpha + x) \;
\Gamma(\beta + n - x)}{\Gamma(\alpha + \beta + n)} \notag \\
&amp;= {n \choose x} \frac{B(\alpha + x, \; \beta + n - x)}{B(\alpha, \; \beta)},
\; x \in \{0, 1, \ldots, n\}, \;\;\; \alpha, \; \beta &gt; 0
\end{align} \tag{1.4}\]</span></span> a <a href="https://en.wikipedia.org/wiki/Beta-binomial_distribution">beta-binomial</a> distribution<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>.</p>
<p>If we assume the prior distribution <span class="math inline">\(\theta \sim Beta(1, 1)\)</span> to express our ignorance of <span class="math inline">\(\theta\)</span>, then <a href="#eq-beta-binomial">Equation&nbsp;<span>1.4</span></a> evaluates to <span class="math display">\[f(x) = \frac{1}{n+1}, \; x = 0, 1, \ldots, n\]</span> the density for a discrete uniform.</p>
<p>If we assume the prior distribution <span class="math inline">\(\theta \sim Beta(2, 3)\)</span> to express our prior knowledge of <span class="math inline">\(\theta\)</span>, then <span class="math display">\[\begin{align}
f(x) &amp;= \frac{n!}{x!\;(n-x)!}\;\frac{4!}{1!\;2!} \;
\frac{(x+1)! \; (n-x+2)!}{(n+4)!}, \;\; x = 0, 1, \ldots, n
\end{align}\]</span></p>
<p>These two marginal distributions look like this (for Example 1 with <span class="math inline">\(n = 6\)</span>):</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>alpha_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>alpha_2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>dbetabinomial <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, alpha, beta){</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">choose</span>(n, x) <span class="sc">*</span> <span class="fu">beta</span>(alpha <span class="sc">+</span> x, beta <span class="sc">+</span> n <span class="sc">-</span> x)<span class="sc">/</span>(<span class="fu">beta</span>(alpha, beta)) </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>marg_dists <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marginal_1 =</span> <span class="fu">dbetabinomial</span>(x, n, alpha_1, beta_1),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">marginal_2 =</span> <span class="fu">dbetabinomial</span>(x, n, alpha_2, beta_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(marginal_1, marginal_2), <span class="at">names_to =</span> <span class="st">"example"</span>, </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"density"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(example)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"x: "</span>, x, <span class="st">"&lt;/br&gt;&lt;/br&gt;density: "</span>,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">round</span>(density, <span class="dv">3</span>)))) <span class="sc">+</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"x"</span>,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span>n,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span>n) <span class="sc">+</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Marginal Density"</span>) <span class="sc">+</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(marg_dists, example <span class="sc">==</span> <span class="st">"marginal_1"</span>),</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"f(x) = P(X = x)"</span>)),</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(marg_dists, example <span class="sc">==</span> <span class="st">"marginal_2"</span>),</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"f(x) = P(X = x)"</span>)),</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>annot_base <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fl">1.0</span>,</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xref =</span> <span class="st">"paper"</span>,</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yref =</span> <span class="st">"paper"</span>,</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xanchor =</span> <span class="st">"center"</span>,</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yanchor =</span> <span class="st">"bottom"</span>,</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>                  <span class="at">showarrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.225</span>,</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B1 = "</span>, alpha_1, <span class="st">", \U03B2 = "</span>, beta_1))</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>a_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.775</span>,</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B1 = "</span>, alpha_2, <span class="st">", \U03B2 = "</span>, beta_2))</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(p1, p2, <span class="at">titleY =</span> <span class="cn">TRUE</span>, <span class="at">titleX =</span> <span class="cn">TRUE</span>, <span class="at">margin =</span> <span class="fl">0.08</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">annotations =</span> <span class="fu">list</span>(a_1, a_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-f8a87d00b449d5d929d9" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f8a87d00b449d5d929d9">{"x":{"data":[{"orientation":"v","width":[0.9,0.9,0.9,0.9,0.9,0.9,0.9],"base":[0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6],"y":[0.142857142857143,0.142857142857143,0.142857142857143,0.142857142857143,0.142857142857143,0.142857142857143,0.142857142857143],"text":["x: 0<\/br><\/br>density: 0.143","x: 1<\/br><\/br>density: 0.143","x: 2<\/br><\/br>density: 0.143","x: 3<\/br><\/br>density: 0.143","x: 4<\/br><\/br>density: 0.143","x: 5<\/br><\/br>density: 0.143","x: 6<\/br><\/br>density: 0.143"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9,0.9,0.9,0.9,0.9,0.9],"base":[0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6],"y":[0.133333333333333,0.2,0.214285714285714,0.19047619047619,0.142857142857143,0.0857142857142857,0.0333333333333333],"text":["x: 0<\/br><\/br>density: 0.133","x: 1<\/br><\/br>density: 0.2","x: 2<\/br><\/br>density: 0.214","x: 3<\/br><\/br>density: 0.19","x: 4<\/br><\/br>density: 0.143","x: 5<\/br><\/br>density: 0.086","x: 6<\/br><\/br>density: 0.033"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null}],"layout":{"xaxis":{"domain":[0,0.42],"automargin":true,"type":"linear","autorange":false,"range":[-0.795,6.795],"tickmode":"array","ticktext":[0,1,2,3,4,5,6],"tickvals":[0,1,2,3,4,5,6],"categoryorder":"array","categoryarray":[0,1,2,3,4,5,6],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"y","title":"x","hoverformat":".2f"},"xaxis2":{"domain":[0.58,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.795,6.795],"tickmode":"array","ticktext":[0,1,2,3,4,5,6],"tickvals":[0,1,2,3,4,5,6],"categoryorder":"array","categoryarray":[0,1,2,3,4,5,6],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"y2","title":"x","hoverformat":".2f"},"yaxis2":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0107142857142857,0.225],"tickmode":"array","ticktext":["0.00","0.05","0.10","0.15","0.20"],"tickvals":[0,0.05,0.1,0.15,0.2],"categoryorder":"array","categoryarray":["0.00","0.05","0.10","0.15","0.20"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"x2","title":"f(x) = P(X = x)","hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.00714285714285714,0.15],"tickmode":"array","ticktext":["0.00","0.05","0.10","0.15"],"tickvals":[0,0.05,0.1,0.15],"categoryorder":"array","categoryarray":["0.00","0.05","0.10","0.15"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":5.31340805313408,"tickwidth":2.65670402656704,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":17.0029057700291},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":2.65670402656704,"zeroline":false,"anchor":"x","title":"f(x) = P(X = x)","hoverformat":".2f"},"annotations":[{"y":1,"font":{"size":16},"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false,"x":0.225,"text":"α = 1, β = 1"},{"y":1,"font":{"size":16},"xref":"paper","yref":"paper","xanchor":"center","yanchor":"bottom","showarrow":false,"x":0.775,"text":"α = 2, β = 3"}],"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.966074191478924,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.42,"y0":0,"y1":1},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.966074191478924,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.58,"x1":1,"y0":0,"y1":1}],"images":[],"margin":{"t":56.381901203819,"r":10.6268161062682,"b":58.4474885844749,"l":71.1996679119967},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":21.2536322125363},"title":{"text":"Marginal Density","font":{"color":"rgba(0,0,0,1)","family":"","size":25.5043586550436},"x":0.5,"xref":"paper"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":2.74874731567645,"font":{"color":"rgba(0,0,0,1)","family":"","size":17.0029057700291}},"hovermode":"closest","barmode":"relative"},"attrs":{"425042e9279d":{"x":{},"y":{},"text":{},"type":"bar"},"42501bcc21e4":{"x":{},"y":{},"text":{},"type":"bar"}},"source":"A","config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Two marginal densities.</p>
</div>
</div>
<p>Stopping to think about this, these plots make sense: if we have no knowledge of <span class="math inline">\(\theta\)</span> (recall that a <span class="math inline">\(Beta(1,1)\)</span> distribution is “noninformative”), then any value of <span class="math inline">\(x\)</span> should be no more or less likely than any other possible value of <span class="math inline">\(x\)</span> conditional on our current knowledge of <span class="math inline">\(\theta\)</span>. If we have some idea of <span class="math inline">\(\theta\)</span> (a <span class="math inline">\(Beta(2, 3)\)</span> describes our belief that it is likely that <span class="math inline">\(\theta &lt; 0.5\)</span>, see <a href="#fig-beta-priors">Figure&nbsp;<span>1.3</span></a>), then we would also expect the marginal distribution of <span class="math inline">\(X\)</span> to be skewed towards lower values, as seen above.</p>
<p>Having integrated <span class="math inline">\(\theta\)</span> out of the joint distribution of <span class="math inline">\(X\)</span> and <span class="math inline">\(\theta\)</span>, we can see that the marginal distribution is a constant in <span class="math inline">\(\theta\)</span>. This constant is exactly the value needed to normalize the numerator in <a href="#eq-bayes-theorem">Equation&nbsp;<span>1.1</span></a>, making the posterior distribution a true distribution.</p>
<p>For example, if <span class="math inline">\(\theta \sim Beta(1,1)\)</span>, then <span class="math inline">\(p(\theta) = 1, \; 0 \leq \theta \leq 1\)</span>. So the numerator in <a href="#eq-bayes-theorem">Equation&nbsp;<span>1.1</span></a> is <span class="math display">\[\begin{align}
f(x \; | \; \theta)\;p(\theta) &amp;= f(x \;| \; \theta) \times 1 \\
&amp;= f(x \; | \; \theta) \\
&amp;= \mathcal{L}(\theta \; | \; x)
\end{align}\]</span> and we have already integrated our likelihoods for Examples 1 and 2 in <a href="#tbl-likelihood-integrals">Table&nbsp;<span>1.1</span></a>. If we divide the values in this table by <span class="math inline">\(f(x) = \frac{1}{n+1}\)</span> for the corresponding <span class="math inline">\(n\)</span>, we get exactly 1 for both, i.e., we normalized the numerator, and so the posterior distribution is now a true distribution<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>.</p>
</section>
<section id="appendix-b" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="appendix-b"><span class="header-section-number">1.7.2</span> Appendix B - Derivation of the Posterior in Our Examples</h3>
<p>For our examples, we have assumed <span class="math display">\[\begin{align}
X|\theta &amp;\sim Binomial(n, \; \theta) \\
\theta &amp;\sim Beta(\alpha, \; \beta)
\end{align}\]</span> Then <span class="math display">\[\begin{align}
p( \theta \; | \; x) &amp;=
\frac{f( x \; | \; \theta)\; p( \theta )}{f\left( x \right)} \notag \\
&amp;\propto f( x \; | \; \theta)\; p( \theta ) \notag \\
&amp;= {n \choose x}\theta^x(1 - \theta)^{n-x} \;
\frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\;\Gamma(\beta)} \;
\theta^{\alpha - 1}\;(1-\theta)^{\beta - 1} \notag \\
&amp;\propto \theta^{\alpha + x - 1}\;(1 - \theta)^{\beta + n - x - 1} \notag \\
&amp;\implies \theta\;|\;x \sim Beta(\alpha + x, \; \beta + n - x)
\end{align}\]</span></p>
</section>
<section id="appendix-c" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="appendix-c"><span class="header-section-number">1.7.3</span> Appendix C - Derivation of the Posterior Predictive Distribution in Our Examples</h3>
<p>In <a href="#appendix-b">Appendix B</a> we derived the posterior distribution of <span class="math inline">\(\theta\)</span>. Here we will derive the posterior predictive distribution used for posterior predictive checking and to simulate/predict future data.</p>
<p>After collecting <span class="math inline">\(x\)</span> positive responses out of <span class="math inline">\(n\)</span> respondents, we want the density for the number of positive responses, <span class="math inline">\(x^*\)</span>, out of <span class="math inline">\(n^*\)</span> future respondents: <span class="math display">\[\begin{align}
f(x^* | x) &amp;= \int \limits_{\Theta} p\left( x^*, \; \theta  | x \right) \;
\mathrm{d}\theta \notag \\
&amp;= \int \limits_{\Theta}f\left( x^* | \theta, x \right)
p\left( \theta | x \right) \; \mathrm{d}\theta  \notag \\
&amp;= \int \limits_{\Theta}f\left( x^* | \theta \right)
p\left( \theta | x \right) \; \mathrm{d}\theta \\
&amp;= \int_0^1 {n^* \choose x^*}\theta^{x^*}(1 - \theta)^{n^* - x^*}
\frac{\Gamma(\alpha + \beta + n)}{\Gamma(\alpha + x)\Gamma(\beta + n - x)}
\theta^{\alpha + x - 1}(1 - \theta)^{\beta + n - x - 1} \;
\mathrm{d}\theta \notag \\
&amp;= {n^* \choose x^*} \frac{\Gamma(\alpha + \beta + n)}{\Gamma(\alpha + x) \; \Gamma(\beta + n - x)}
\frac{\Gamma(\alpha + x + x^*) \;
\Gamma(\beta + n - x + n^* - x^*)}{\Gamma(\alpha + \beta + n + n^*)} \notag \\
&amp;= {n^* \choose x^*}
\frac{B(\alpha + x + x^*, \; \beta + n - x + n^* - x^*)}{B(\alpha + x, \; \beta + n - x)},
\; x^* \in \{0, 1, \ldots, n^*\}
\end{align}\]</span> another beta-binomial distribution.</p>
<p>You can see that this is similar to <a href="#eq-marginal-distribution">Equation&nbsp;<span>1.2</span></a> in that it shows the posterior predictive distribution as an average of conditional predictions over the posterior distribution of <span class="math inline">\(\theta\)</span>. That is, it is equal to the conditional sampling density of <span class="math inline">\(X^*\)</span>averaged over all possible values of <span class="math inline">\(\theta\)</span> conditioned on our data.</p>


<!-- -->

</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>You might see least squares, AIC, BIC, or -2 LL, but the idea is the same.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The likelihood contains all the information contained in the data<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This might be called a “probability mass function” for discrete <span class="math inline">\(x\)</span>, a “probability density function” for continuous <span class="math inline">\(x\)</span> or as a generic term, or simply the “density”, and the reader should know from context what is meant.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You can argue that regularization methods like <a href="https://en.wikipedia.org/wiki/Tikhonov_regularization">ridge regression</a> and <a href="https://en.wikipedia.org/wiki/Lasso_(statistics)">lasso</a> incorporate prior information with the constraint parameter (<span class="math inline">\(\lambda\)</span>). Most people don’t think of the constraint as prior information, but there is a direct Bayesian analogue (with <em>maximum a posteriori</em> (MAP) estimation) to (many) regularization methods.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The integral is used generally. If the parameter space of <span class="math inline">\(\theta\)</span> is discrete, this will be a summation, and if <span class="math inline">\(\theta\)</span> is a vector, then there will be multiple integrals (and/or summations)<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>For now, disregard that <a href="https://normaldeviate.wordpress.com/2013/07/13/lost-causes-in-statistics-ii-noninformative-priors/">no priors are truly noninformative</a>. and that “noninformative” priors are often a <a href="http://www.stat.columbia.edu/~gelman/research/published/taumain.pdf">bad idea</a>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>For <span class="math inline">\(X \sim Beta(\alpha, \beta)\)</span>, <span class="math display">\[\begin{align}
f(x) &amp;= \frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\;\Gamma(\beta)} \;
x^{\alpha - 1}\;(1-x)^{\beta - 1} \\
&amp;= \frac{1}{B(\alpha, \beta)}\;x^{\alpha - 1}\;(1-x)^{\beta - 1},
\; 0 \leq x \leq 1, \;\;\; \alpha, \; \beta &gt; 0
\end{align}\]</span> where <span class="math inline">\(\Gamma(\cdot)\)</span> is the <a href="https://en.wikipedia.org/wiki/Gamma_function">Gamma function</a> and <span class="math inline">\(B(\cdot, \cdot)\)</span> is the <a href="https://en.wikipedia.org/wiki/Beta_function">Beta function</a><a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>They do integrate to 1 with respect to <span class="math inline">\(x\)</span> (see <a href="#fig-binomial-densities">Figure&nbsp;<span>1.1</span></a>), but they do not with respect to <span class="math inline">\(\theta\)</span>, which is why they are not true probability distributions for <span class="math inline">\(\theta\)</span><a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>It should be noted that the marginal distribution is technically dependent on the hyperparameters, e.g., for our examples with hyperpriors <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> in <span class="math inline">\(p(\theta)\)</span>, <span class="math inline">\(f(x)\)</span> is technically <span class="math inline">\(f_{\alpha, \beta}(x)\)</span>, but the dependence on the hyperparameters is understood.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>We will talk about this later when we go into setting priors for complex problems<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>Our examples here have been simple and used <a href="https://en.wikipedia.org/wiki/Conjugate_prior">conjugate priors</a>, so we have been able to find a closed-form solution for the posterior. This is rarely the case in our real-life problems in the PK/PD world.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>Python also has a NUTS implementation in the <a href="https://www.pymc.io/welcome.html">PyMC</a> package. Julia has a NUTS implementation in the <a href="https://turing.ml/stable/">Turing</a> package, NONMEM also can sample from the posterior using either M-H and Gibbs with the BAYES method or using NUTS with the NUTS method.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>With <span class="math inline">\(n^* = 6 = n\)</span>, we are also doing a <em>posterior predictive check (PPC)</em>. The idea of PPC is that if a model is a good fit, then we should be able to use it to generate data that looks a lot like the data we observed.<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>The beta-binomial distribution is similar to the binomial distribution in that it gives the probability of observing <span class="math inline">\(x\)</span> successes in <span class="math inline">\(n\)</span> trials. However, while the binomial distribution considers <span class="math inline">\(\theta\)</span> fixed and known, the beta-binomial distribution assumes <span class="math inline">\(\theta\)</span> is either unknown or random and incorporates this uncertainty in <span class="math inline">\(\theta\)</span> by treating <span class="math inline">\(\theta\)</span> as a draw from a Beta distribution. This uncertainty in <span class="math inline">\(\theta\)</span> has the effect of giving the beta-binomial a slightly larger variance than the binomial<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>The lack of normalization is why frequentist inference can’t talk about the likelihood as a <em>distribution</em><a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./stancodeblocks.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Stan</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Introduction to Bayesian Methods for Inference"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Code"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 5</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE, echo=FALSE}</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">eval =</span> <span class="cn">TRUE</span>, <span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>, </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">include =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>def.chunk.hook  <span class="ot">&lt;-</span> knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">get</span>(<span class="st">"chunk"</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">chunk =</span> <span class="cf">function</span>(x, options) {</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">def.chunk.hook</span>(x, options)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(options<span class="sc">$</span>size <span class="sc">!=</span> <span class="st">"normalsize"</span>, <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">"</span>, options<span class="sc">$</span>size,<span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>, x, </span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"</span><span class="sc">\n\n</span><span class="st"> </span><span class="sc">\\</span><span class="st">normalsize"</span>), x)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="fu">RNGkind</span>(<span class="at">sample.kind =</span> <span class="st">"Rounding"</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;style&gt;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="st">caption {</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="st">      color: black;</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="st">      font-weight: bold;</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="st">      font-size: 1.25em;</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="st">      align: center;</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/style&gt;</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r package-load, include=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="co"># library(collapsibleTree)</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magick)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>, <span class="at">base_line_size =</span> <span class="dv">2</span>))</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="fu">register_knitr_engine</span>()</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>This document is is meant to introduce you to the most basic elements of Bayesian inference. It is in no way comprehensive, but it will hopefully give you a platform of understanding so that you can get as much as possible out of this tutorial.</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>Here are a few references that we've found useful in our Bayesian lives:</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Bayesian Data Analysis</span><span class="co">](http://www.stat.columbia.edu/~gelman/book/)</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Statistical Rethinking</span><span class="co">](https://xcelab.net/rm/statistical-rethinking/)</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Regression and Other Stories</span><span class="co">](https://avehtari.github.io/ROS-Examples/index.html)</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Jose Storopoli's</span><span class="co">](https://storopoli.io/)</span> slides on <span class="co">[</span><span class="ot">Bayesian Statistics</span><span class="co">](https://github.com/storopoli/Bayesian-Statistics)</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Stan Discourse</span><span class="co">](https://discourse.mc-stan.org/)</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistical Inference</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In any experiment, survey, observational study, or clinical trial, we are using sample data to try to answer some question(s) about the population of interest.</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We collect (sample) *data* $\left(X\right)$ to estimate *parameters* $\left(\theta\right)$ and perform some sort of inference (point estimation, confidence intervals, hypothesis tests, \ldots) to say something/make decisions about the "population."</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>However, learning from the data is complicated by the natural variability of the measurements, so we can't find the "correct" values of the parameters.</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We want to quantify our knowledge/uncertainty about the parameters with point estimates, i.e., "typical" values, and uncertainty estimates such as standard errors, CV%, and confidence intervals.</span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="fu">### Motivating Examples</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>We want to estimate the proportion of the population that likes <span class="co">[</span><span class="ot">Mountain Dew Cheesecake</span><span class="co">](https://www.tastemade.com/shows/the-scran-line/mountain-dew-cheesecake)</span>.</span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>\vspace{0.25 in}</span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span><span class="al">![](Images/mt_dew_cheesecake.png)</span>{width="250px"}<span class="kw">&lt;/center&gt;</span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example 1</span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>After collecting $n = 6$ data points where $x = 5$ people liked it, we want to make inferences about the population parameter $\theta$, the proportion of people in the population that likes Mt. Dew Cheesecake.</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example 2</span></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>After collecting $n = 60$ data points where $x = 50$ people liked it, we want to make inferences about the population parameter $\theta$</span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## Frequentist/Likelihoodist Approach</span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>The most common methods for parameter estimation in non-Bayesian paradigms involve some sort of optimization. For this problem, we'll use <span class="co">[</span><span class="ot">maximum likelihood</span><span class="co">](https://en.wikipedia.org/wiki/Maximum_likelihood_estimation)</span>, <span class="ot">[^intro-1]</span> where we find the value of $\theta$ that maximizes the likelihood<span class="ot">[^intro-2]</span>, or, in other words, we find the value of $\theta$ that maximizes the probability of observing the data that we have observed.</span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-1]: </span>You might see least squares, AIC, BIC, or -2 LL, but the idea is the same.</span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-2]: </span>The likelihood contains all the information contained in the data</span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>In the above example, we assume the data has a <span class="co">[</span><span class="ot">binomial distribution</span><span class="co">](https://en.wikipedia.org/wiki/Binomial_distribution)</span> with $n$ trials and probability of success, $\theta$, i.e. $X \sim Bin(n,\theta)$. Then we can write out the density<span class="ot">[^intro-3]</span> $f(x \;| \; \theta)$, the probability that we would would observe $x$ "successes" out of $n$ trials for a given value of $\theta$ for any value of $x \in <span class="sc">\{</span>0, 1, 2, \ldots, n<span class="sc">\}</span>$ and $0 \leq \theta \leq 1$: $$ \begin{align}</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>f(x | \theta) &amp;= P(X = x \;| \;\theta) <span class="sc">\\</span> </span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>&amp;= {n \choose x}\theta^x(1 - \theta)^{n-x},</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>\;\; x = 0, \; 1, \; 2, \;\ldots, \; n</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>\end{align}$$</span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-3]: </span>This might be called a "probability mass function" for discrete $x$, a "probability density function" for continuous $x$ or as a generic term, or simply the "density", and the reader should know from context what is meant.</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>For Example 1 above with $n = 6$, for $\theta$ values of 0.4 and 0.75, the density of $X$ looks like this:</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.align="center"}</span></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-binomial-densities</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Two Binomial Densities"</span></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.40</span>, <span class="fl">0.75</span>)</span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a>binom_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span>n_1, <span class="at">times =</span> <span class="fu">length</span>(probs)), </span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>                    <span class="at">theta =</span> <span class="fu">rep</span>(probs, <span class="at">each =</span> n_1 <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbinom</span>(x, n_1, <span class="at">prob =</span> theta))</span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density,</span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"x: "</span>, x, <span class="st">"&lt;/br&gt;&lt;/br&gt;density: "</span>, </span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">round</span>(density, <span class="dv">3</span>)))) <span class="sc">+</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"x"</span>,</span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span>n_1,</span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span>n_1) <span class="sc">+</span></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Binomial Density"</span>) <span class="sc">+</span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span> </span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(binom_data, theta <span class="sc">==</span> probs[<span class="dv">1</span>]),</span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"P(X = x | \U03B8 = "</span>, probs[<span class="dv">1</span>],<span class="st">")"</span>)),</span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span> </span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(binom_data, theta <span class="sc">==</span> probs[<span class="dv">2</span>]),</span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"P(X = x | \U03B8 = "</span>, probs[<span class="dv">2</span>],<span class="st">")"</span>)),</span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>annot_base <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fl">1.0</span>,</span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>                   <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">16</span>), </span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xref =</span> <span class="st">"paper"</span>, </span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yref =</span> <span class="st">"paper"</span>, </span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xanchor =</span> <span class="st">"center"</span>, </span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yanchor =</span> <span class="st">"bottom"</span>, </span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a>                   <span class="at">showarrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.2</span>,</span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B8 = "</span>, probs[<span class="dv">1</span>])) </span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.8</span>,</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B8 = "</span>, probs[<span class="dv">2</span>])) </span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(p1, p2, <span class="at">titleY =</span> <span class="cn">TRUE</span>, <span class="at">titleX =</span> <span class="cn">TRUE</span>, <span class="at">margin =</span> <span class="fl">0.08</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">annotations =</span> <span class="fu">list</span>(a1, a2))</span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a>But we want to maximize the *likelihood* function, $\mathcal{L}(\theta \; | \; x)$. Luckily for us, it is the **same as the density**, but is a function of $\theta$ for a given $x$, instead of $X$ for a given $\theta$. That is, $\mathcal{L}(\theta \; | \; x) = f(x \;| \; \theta)$. For Example 1 with $n = 6$ and $x = 5$ the likelihood is as below \begin{align}</span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(\theta \; | \; x)  &amp;= {n \choose x}\theta^x(1 - \theta)^{n-x} <span class="sc">\\</span> </span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a>&amp;= {6 \choose 5}\theta^5(1 - \theta)^{6 - 5}, \;\; 0 \leq \theta \leq 1</span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.align="center"}</span></span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-binomial-likelihood</span></span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Binomial likelihood."</span></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a>(binom_like_plot_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">dbinom</span>(x_1, n_1, <span class="at">prob =</span> theta)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> likelihood)) <span class="sc">+</span></span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"L(\U03B8 | X = "</span>, x_1, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"Binomial Likelihood, n = "</span>, n_1, <span class="st">", X = "</span>, x_1)) <span class="sc">+</span></span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a>The *maximum likelihood estimate* (MLE), $\hat\theta$, is the value of $\theta$ that maximizes this function. That is, $$\hat\theta = \underset{\theta}{\mathrm{argmax}} \; </span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(\theta \; | \; x)$$</span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a>Intuitively, it is the value of $\theta$ that is "most likely" given the observed data. For example, in our example it doesn't seem likely that we would observe our data if $\theta = 0.25$, but it seems more likely that we could observe this data if $\theta = 0.8$ or so.</span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a>We also want to quantify the uncertainty of this estimate, typically with a *standard error*. A larger standard error means we are more uncertain about our estimate than a smaller standard error, and in a sense, the standard error is a measure of the "pointiness" of the likelihood. The (asymptotic) standard error can be calculated as the square root of the diagonals of the inverse of the <span class="co">[</span><span class="ot">Fisher information</span><span class="co">](https://en.wikipedia.org/wiki/Fisher_information)</span> matrix evaluated at the MLE (the <span class="co">[</span><span class="ot">observed Fisher information</span><span class="co">](https://en.wikipedia.org/wiki/Observed_information)</span>. See <span class="co">[</span><span class="ot">here</span><span class="co">](http://www.sherrytowers.com/mle_introduction.pdf)</span> for a more thorough discussion of MLEs, Fisher information, and the form when $\theta$ is a vector). An intuitive explanation of the relationship of the standard errors to the Fisher information matrix is that the standard error is a measure of the curvature of the likelihood. Roughly, more information in the data $\implies$ large negative values in the observed Fisher information matrix (more curvature) $\implies$ smaller values after inversion to get the variance.</span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a>This particular example has a simple, closed-form solution, but most of our problems in the PK/PD world require a numerical optimization, typically by some gradient-based method. So for our example, we can do this numerical optimization in R</span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r numerical-mles}</span></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a>x_1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a>n_2 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a>n_2 <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>example_mle_1 <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fl">0.3</span>, </span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fn =</span> <span class="cf">function</span>(theta, n, x) </span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">-</span><span class="fu">dbinom</span>(x, n, theta, <span class="at">log =</span> <span class="cn">TRUE</span>), </span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> n_1, <span class="at">x =</span> x_1, </span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"Brent"</span>, </span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>                       <span class="at">hessian =</span> <span class="cn">TRUE</span>, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)</span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a>example_mle_2 <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fl">0.3</span>, </span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fn =</span> <span class="cf">function</span>(theta, n, x) </span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">-</span><span class="fu">dbinom</span>(x, n, theta, <span class="at">log =</span> <span class="cn">TRUE</span>), </span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> n_2, <span class="at">x =</span> x_2, </span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">"Brent"</span>, </span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a>                       <span class="at">hessian =</span> <span class="cn">TRUE</span>, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)</span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span>Example, <span class="sc">~</span>MLE, <span class="sc">~</span>SE,</span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, example_mle_1<span class="sc">$</span>par, <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.double</span>(example_mle_1<span class="sc">$</span>hessian)),</span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>, example_mle_2<span class="sc">$</span>par, <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.double</span>(example_mle_2<span class="sc">$</span>hessian))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">"Numerical MLE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a>                            <span class="at">position =</span> <span class="st">"center"</span>)</span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r binomial-likelihood-with-mle, fig.align="center", fig.cap="Two binomial likelihoods with MLE.", fig.width=12}</span></span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a>x_ticks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(example_mle_1<span class="sc">$</span>par, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)))</span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a>tick_colors <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x_ticks <span class="sc">==</span> example_mle_1<span class="sc">$</span>par, <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> binom_like_plot_1 <span class="sc">+</span></span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> example_mle_1<span class="sc">$</span>par, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> example_mle_1<span class="sc">$</span>par, </span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> <span class="fu">dbinom</span>(x_1, n_1, example_mle_1<span class="sc">$</span>par)),</span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks,</span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors)) <span class="sc">+</span></span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"n = "</span>, n_1, <span class="st">", X = "</span>, x_1))</span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">dbinom</span>(x_2, n_2, <span class="at">prob =</span> theta)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> likelihood)) <span class="sc">+</span></span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"L(\U03B8 | X = "</span>, x_2, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"Binomial Likelihood, n = "</span>, n_2, <span class="st">", X = "</span>, x_2)) <span class="sc">+</span></span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> example_mle_2<span class="sc">$</span>par, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> example_mle_2<span class="sc">$</span>par, </span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> <span class="fu">dbinom</span>(x_2, n_2, example_mle_2<span class="sc">$</span>par)),</span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks,</span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors)) <span class="sc">+</span></span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">"n = "</span>, n_2, <span class="st">", X = "</span>, x_2))</span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a>(ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, </span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a>    ggpubr<span class="sc">::</span><span class="fu">annotate_figure</span>(</span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a>      <span class="at">top =</span> ggpubr<span class="sc">::</span><span class="fu">text_grob</span>(<span class="st">"Binomial Likelihoods with MLE"</span>, </span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">24</span>))) </span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian Approach</span></span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>Classical methods treat the parameter(s) as fixed and the data random and then find a point estimate and standard error using only information from the data<span class="ot">[^intro-4]</span>. In contrast, Bayesian methods treat the parameter(s) as a random variable and consider the data fixed and then make inferences based on a proper *distribution*. These methods initially allocate probability to all possible parameter values via a *prior distribution* and then reallocate probability when new information is gained. Bayesian inference depends on our ability to quantify the *posterior distribution* of the parameters conditioned on the data. This posterior distribution contains all of our knowledge about $\theta$ (prior knowledge and knowledge obtained from the data).</span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-4]: </span>You can argue that regularization methods like <span class="co">[</span><span class="ot">ridge regression</span><span class="co">](https://en.wikipedia.org/wiki/Tikhonov_regularization)</span> and <span class="co">[</span><span class="ot">lasso</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Lasso_(statistics)) incorporate prior information with the constraint parameter ($\lambda$). Most people don't think of the constraint as prior information, but there is a direct Bayesian analogue (with *maximum a posteriori* (MAP) estimation) to (many) regularization methods.</span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayes' Theorem</span></span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a>The form of the posterior distribution follows from <span class="co">[</span><span class="ot">Bayes' Theorem</span><span class="co">](https://en.wikipedia.org/wiki/Bayes%27_theorem)</span><span class="ot">[^intro-5]</span>: $$\begin{align}</span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a>\color{blue}{p\left( \theta | x\right)} &amp;= </span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a>\frac{p(x, \theta)}{\color{red}{f\left( x \right)}} \notag <span class="sc">\\</span></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\color{green}{f\left( x | \theta\right)}\color{orange}{p\left( \theta </span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>\right)}}{\color{red}{f\left( x \right)}} \notag <span class="sc">\\</span></span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\color{green}{f\left( x | \theta\right)}\color{orange}{p\left( \theta </span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>\right)}}{\color{red}{\int \limits_{\Theta}f\left( x | \theta\right) </span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a>p\left( \theta \right) \mathrm{d}\theta}} </span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a>\end{align}$$ {#eq-bayes-theorem}</span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-5]: </span>The integral is used generally. If the parameter space of $\theta$ is discrete, this will be a summation, and if $\theta$ is a vector, then there will be multiple integrals (and/or summations)</span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Prior Distribution</span></span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a>We begin with the <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"orange"</span><span class="kw">&gt;</span>prior distribution<span class="kw">&lt;/font&gt;</span> to quantify our knowledge/beliefs about $\theta$ before we collect data. For our examples, we might assume</span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a>1)  a "noninformative" prior distribution<span class="ot">[^intro-6]</span> and use a $Uniform(0, 1)$ (equivalent to a $Beta(1,1)$<span class="ot">[^intro-7]</span> distribution for $p(\theta)$). This is a simple way to express our ignorance about $\theta$.</span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>2)  an informative prior that expresses our belief that most people will not like Mt. Dew Cheesecake. We might quantify this with a $Beta(2, 3)$ distribution.</span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-6]: </span>For now, disregard that <span class="co">[</span><span class="ot">no priors are truly noninformative</span><span class="co">](https://normaldeviate.wordpress.com/2013/07/13/lost-causes-in-statistics-ii-noninformative-priors/)</span>. and that "noninformative" priors are often a <span class="co">[</span><span class="ot">bad idea</span><span class="co">](http://www.stat.columbia.edu/~gelman/research/published/taumain.pdf)</span>.</span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-7]: </span>For $X \sim Beta(\alpha, \beta)$, $$\begin{align}</span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a>    f(x) &amp;= \frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\;\Gamma(\beta)} \;</span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a>    x^{\alpha - 1}\;(1-x)^{\beta - 1} <span class="sc">\\</span></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a>    &amp;= \frac{1}{B(\alpha, \beta)}\;x^{\alpha - 1}\;(1-x)^{\beta - 1}, </span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a>    \; 0 \leq x \leq 1, \;\;\; \alpha, \; \beta &gt; 0</span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a>    \end{align}$$ where $\Gamma(\cdot)$ is the <span class="co">[</span><span class="ot">Gamma function</span><span class="co">](https://en.wikipedia.org/wiki/Gamma_function)</span> and $B(\cdot, \cdot)$ is the <span class="co">[</span><span class="ot">Beta function</span><span class="co">](https://en.wikipedia.org/wiki/Beta_function)</span></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-beta-priors</span></span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Two beta priors."</span></span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a>alpha_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a>alpha_2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">01</span>)</span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a>df_prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta, <span class="at">prior_1 =</span> <span class="fu">dbeta</span>(theta, alpha_1, beta_1),</span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior_2 =</span> <span class="fu">dbeta</span>(theta, alpha_2, beta_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(prior_1, prior_2), <span class="at">names_to =</span> <span class="st">"example"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(example)</span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a>(prior_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_prior, <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value, </span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">color =</span> example)) <span class="sc">+</span></span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8)"</span>)) <span class="sc">+</span></span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Prior"</span>,</span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"prior_1"</span>, <span class="st">"prior_2"</span>),</span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>),</span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Uniform (Beta(1, 1))"</span>,</span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Informative (Beta(2, 3))"</span>)))</span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Likelihood</span></span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a>The <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"green"</span><span class="kw">&gt;</span>likelihood<span class="kw">&lt;/font&gt;</span> is the same (see @fig-binomial-likelihood) as we had when we were using optimization methods (recall that $\mathcal{L}(\theta \; | \; x) = f(x \;| \; \theta)$).</span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r likelihoods, fig.width=11, fig.align="center", fig.cap="Unnormalized Likelihoods."}</span></span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a>df_likelihood <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta) <span class="sc">%&gt;%</span></span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood_1 =</span> <span class="fu">dbinom</span>(x_1, n_1, <span class="at">prob =</span> theta),</span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood_2 =</span> <span class="fu">dbinom</span>(x_2, n_2, <span class="at">prob =</span> theta)) <span class="sc">%&gt;%</span></span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(likelihood_1, likelihood_2), <span class="at">names_to =</span> <span class="st">"example"</span>,</span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(example)</span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a>plot_likelihood <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_likelihood, <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value,</span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">color =</span> example)) <span class="sc">+</span></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"f(x | (\U03B8) = L(\U03B8 | X)"</span>)) <span class="sc">+</span></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Likelihood"</span>,</span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"likelihood_1"</span>, <span class="st">"likelihood_2"</span>),</span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"purple"</span>),</span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"x = "</span>, x_1, <span class="st">", n = "</span>, n_1),</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_c</span>(<span class="st">"x = "</span>, x_2, <span class="st">", n = "</span>, n_2)))</span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a>plot_likelihood</span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a>One thing to notice for each of these likelihoods is that they do not integrate to 1<span class="ot">[^intro-8]</span>, one of the requirements for a function to be a probability distribution. However, the likelihood can be normalized to integrate to 1 by multiplying by a constant. This will be touched upon again in the section on <span class="co">[</span><span class="ot">marginal distributions</span><span class="co">](#marginal-distribution)</span> and in <span class="co">[</span><span class="ot">Appendix A</span><span class="co">](#appendix-a)</span>, and all future plots will plot a scaled likelihood for visual purposes.</span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-8]: </span>They do integrate to 1 with respect to $x$ (see @fig-binomial-densities), but they do not with respect to $\theta$, which is why they are not true probability distributions for $\theta$</span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-likelihood-integrals</span></span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Likelihood Integrals</span></span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a>like_binom <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, n, x) <span class="fu">dbinom</span>(x, n, theta)</span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a>integral_1 <span class="ot">&lt;-</span> <span class="fu">integrate</span>(like_binom, <span class="at">n =</span> n_1, <span class="at">x =</span> x_1, </span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)<span class="sc">$</span>value</span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a>integral_2 <span class="ot">&lt;-</span> <span class="fu">integrate</span>(like_binom, <span class="at">n =</span> n_2, <span class="at">x =</span> x_2, </span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)<span class="sc">$</span>value</span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span>Example, <span class="sc">~</span>Integral,</span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1"</span>, integral_1,</span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2"</span>, integral_2) <span class="sc">%&gt;%</span> </span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">"Likelihood Integrals"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a>                            <span class="at">position =</span> <span class="st">"center"</span>)</span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a>Regardless, the likelihood is a key part of Bayes' Theorem and contains the information about $\theta$ obtained from the data.</span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Marginal Distribution {#marginal-distribution}</span></span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a>Consider the case where $X$ has the sampling density $f(x \;|\; \theta)$ and $\theta$ is a random variable with density $p(\theta)$. Then the joint density of $X$ and $\theta$ is $$f(x, \; \theta) = f(x \;|\; \theta) \; p(\theta),$$ which you will recognize as the numerator in @eq-bayes-theorem. The <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"red"</span><span class="kw">&gt;</span>marginal distribution<span class="kw">&lt;/font&gt;</span><span class="ot">[^intro-9]</span> of $X$ is then $$\begin{align}</span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a>f(x) &amp;= \int \limits_{\Theta}f(x, \; \theta) \; \mathrm{d}\theta \notag <span class="sc">\\</span> </span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a>&amp;= \int \limits_{\Theta}f\left( x | \theta\right) p\left( \theta \right) </span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a>\mathrm{d}\theta </span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a>\end{align}$$ {#eq-marginal-distribution}</span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-9]: </span>It should be noted that the marginal distribution is technically dependent on the hyperparameters, e.g., for our examples with hyperpriors $\alpha$ and $\beta$ in $p(\theta)$, $f(x)$ is technically $f_{\alpha, \beta}(x)$, but the dependence on the hyperparameters is understood.</span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>That is, the marginal density of $X$ is equal to the conditional sampling density of $X$ averaged over all possible values of $\theta$. It can also be thought of as a description of the predictions we would make for $X$ given only our prior knowledge, which is why this is sometimes called the "prior predictive distribution"<span class="ot">[^intro-10]</span>. See <span class="co">[</span><span class="ot">Appendix A</span><span class="co">](#appendix-a)</span> for more discussion on the marginal distribution.</span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-10]: </span>We will talk about this later when we go into setting priors for complex problems</span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a>In practice, the marginal distribution is often analytically intractable, and it is often just cast aside so that we have the posterior distribution *up to a constant*: $$\begin{align}</span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a>\color{blue}{p( \theta \; | \; x)} &amp;= </span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>\frac{\color{green}{f( x \; | \; \theta)}\; \color{orange}{p( \theta )}}</span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a>{\color{red}{f\left( x \right)}} \notag <span class="sc">\\</span></span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a>&amp;\propto \color{green}{f( x \; | \; \theta)}\; \color{orange}{p( \theta )}</span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a>\end{align}$$ {#eq-up-to-constant}</span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a>This inability to find a closed-form for the marginal distribution is not a problem. Modern computational methods such as <span class="co">[</span><span class="ot">Markov Chain Monte Carlo</span><span class="co">](https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo)</span> (MCMC) allow us to sample from the posterior in such a way that the sample represents the true posterior distribution arbitrarily closely, and we can perform our inference based on this sample.</span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Posterior Distribution</span></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>The <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"blue"</span><span class="kw">&gt;</span>posterior distribution<span class="kw">&lt;/font&gt;</span> (See <span class="co">[</span><span class="ot">Appendix B</span><span class="co">](#appendix-b)</span> for a derivation of the posterior for our examples) is the key to all Bayesian inference. It combines the prior distribution and the likelihood and contains all of the available information about $\theta$ (prior knowledge and information obtained from the data):</span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-plot, fig.width=11, fig.align="center", fig.cap="Posterior as a combination of the likelihood and prior."}</span></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a>df_all <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta, </span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_1_1 =</span> <span class="fu">dbeta</span>(theta, alpha_1 <span class="sc">+</span> x_1, beta_1 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_1_2 =</span> <span class="fu">dbeta</span>(theta, alpha_1 <span class="sc">+</span> x_2, beta_1 <span class="sc">+</span> n_2 <span class="sc">-</span> x_2),</span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_2_1 =</span> <span class="fu">dbeta</span>(theta, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a>                 <span class="at">posterior_2_2 =</span> <span class="fu">dbeta</span>(theta, alpha_2 <span class="sc">+</span> x_2, beta_2 <span class="sc">+</span> n_2 <span class="sc">-</span> x_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"posterior"</span>), <span class="at">names_to =</span> <span class="st">"example"</span>, </span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df_prior, </span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a>            df_likelihood) </span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a>df_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"prior_2"</span>, <span class="st">"likelihood_1"</span>, <span class="st">"posterior_2_1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">if_else</span>(example <span class="sc">==</span> <span class="st">"likelihood_1"</span>, value<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>n_1), value)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value, <span class="at">group =</span> example, <span class="at">color =</span> example)) <span class="sc">+</span></span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span> </span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"prior_2"</span>, <span class="st">"likelihood_1"</span>, <span class="st">"posterior_2_1"</span>),</span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"green4"</span>, <span class="st">"blue"</span>),</span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Prior"</span>, <span class="st">"Likelihood"</span>, <span class="st">"Posterior"</span>))</span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a>Once we have our posterior distribution, we can make similar inferences as in frequentist inference:</span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Point estimates - We have a proper *distribution* now, so we can report the posterior <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"red"</span><span class="kw">&gt;</span>mean<span class="kw">&lt;/font&gt;</span>, <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"purple"</span><span class="kw">&gt;</span>median<span class="kw">&lt;/font&gt;</span>, or <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"black"</span><span class="kw">&gt;</span>mode<span class="kw">&lt;/font&gt;</span> ( <span class="in">`r round((alpha_2 + x_1)/(alpha_2 + x_1 + beta_2 + n_1 - x_1), 3)`</span>, <span class="in">`r round(qbeta(0.5, alpha_2 + x_1, beta_2 + n_1 - x_1), 3)`</span>, and <span class="in">`r round((alpha_2 + x_1 - 1)/(alpha_2 + x_1 + beta_2 + n_1 - x_1 - 2), 3)`</span>, respectively).</span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-point-estimates, fig.width=11, fig.align="center", fig.cap="Posterior point estimates."}</span></span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a>posterior_point_estimates <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>type, <span class="sc">~</span>value,</span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mean"</span>, (alpha_2 <span class="sc">+</span> x_1)<span class="sc">/</span>(alpha_2 <span class="sc">+</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a>  <span class="st">"median"</span>, <span class="fu">qbeta</span>(<span class="fl">0.5</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mode"</span>, (alpha_2 <span class="sc">+</span> x_1 <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">/</span>(alpha_2 <span class="sc">+</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1 <span class="sc">-</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbeta</span>(value, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1))</span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a>(p_posterior_with_point_estimates <span class="ot">&lt;-</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span> </span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> posterior_point_estimates, </span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> value, <span class="at">yend =</span> density,</span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> type),</span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.15</span>) <span class="sc">+</span></span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Point Estimate"</span>,</span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"mode"</span>),</span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>, <span class="st">"Mode"</span>),</span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"black"</span>)))</span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Standard deviation (analogous to a standard error) - for our example the standard deviation is <span class="in">`r sqrt((alpha_2 + x_1)*(beta_2 + n_1 - x_1)/((alpha_2 + beta_2 + n_1)^2*(alpha_2 + beta_2 + n_1 + 1))) %&gt;% round(3)`</span></span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Even better, we can make interval estimates, e.g.credible intervals, with a natural probabilistic interpretation:</span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"There is a 95% chance that the true proportion of people who like Mt. Dew cheesecake is between <span class="in">`r qbeta(0.025, alpha_2 + x_1, beta_2 + n_1 - x_1) %&gt;% round(3)`</span> and <span class="in">`r qbeta(0.975, alpha_2 + x_1, beta_2 + n_1 - x_1) %&gt;% round(3)`</span>."</span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"There is an <span class="in">`r round(pbeta(0.5, alpha_2 + x_1, beta_2 + n_1 - x_1, lower.tail = FALSE)*100, 2)`</span>% chance that the true proportion of people who like Mt. Dew cheesecake is at least 0.5."</span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r interval-plots, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a>interval_base <span class="ot">&lt;-</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">c</span>(<span class="fu">qbeta</span>(<span class="fl">0.025</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">qbeta</span>(<span class="fl">0.975</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1)),</span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a>                   <span class="at">example =</span> <span class="st">"posterior_2_1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">dbeta</span>(theta, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(theta) <span class="sc">%&gt;%</span> </span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) <span class="sc">+</span> </span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>))</span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a>x_ticks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(<span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1), </span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)))</span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a>tick_colors <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x_ticks <span class="sc">%in%</span> </span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), </span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a>                               alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1), </span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a>p_ci <span class="ot">&lt;-</span> interval_base <span class="sc">+</span></span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>,</span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">between</span>(theta, </span>
<span id="cb27-516"><a href="#cb27-516" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">qbeta</span>(<span class="fl">0.025</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1), </span>
<span id="cb27-517"><a href="#cb27-517" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">qbeta</span>(<span class="fl">0.975</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1))),</span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"95% credible interval"</span>) <span class="sc">+</span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> x_ticks,</span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors))</span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a>p_gt_50 <span class="ot">&lt;-</span> interval_base <span class="sc">+</span></span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>,</span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">between</span>(theta, <span class="fl">0.50</span>, <span class="dv">1</span>)),</span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"P(\U03B8 &gt; 0.50 | X = 5)"</span>) <span class="sc">+</span></span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a>p_ci <span class="sc">+</span> p_gt_50</span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We can also look at the *posterior predictive distribution* (See [Appendix C](#appendix-c) for a derivation of the posterior predictive distribution for our examples). This is the distribution of possible unobserved values conditional on our observed values. For example, we could look at the density for a future observation, $x^*$, for different future values of $n, n^*$.</span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-predictive-plot, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a>n_star <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>)</span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a>(p_analytical_ppd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x_star =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>n_star[<span class="dv">1</span>], <span class="dv">0</span><span class="sc">:</span>n_star[<span class="dv">2</span>]),</span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a>       <span class="at">n_star =</span> <span class="fu">c</span>(<span class="fu">rep</span>(n_star[<span class="dv">1</span>], <span class="at">times =</span> n_star[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rep</span>(n_star[<span class="dv">2</span>], <span class="at">times =</span> n_star[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> extraDistr<span class="sc">::</span><span class="fu">dbbinom</span>(x_star, n_star, </span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>                                       alpha_2 <span class="sc">+</span> x, beta_2 <span class="sc">+</span> n <span class="sc">-</span> x)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_star, <span class="at">y =</span> density),</span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$x^*$"</span>),</span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star),</span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star)) <span class="sc">+</span></span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$p(x^* | </span><span class="sc">\\</span><span class="st">; x) = P(X^*= x^* | </span><span class="sc">\\</span><span class="st">; x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Posterior Predictive Density"</span>) <span class="sc">+</span></span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n_star, <span class="at">scales =</span> <span class="st">"free_x"</span>, </span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(n<span class="sc">^</span><span class="st">"*"</span> <span class="sc">==</span> .(n_star))))</span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a><span class="fu">## Markov Chain Monte Carlo {#mcmc}</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a>As mentioned in the <span class="co">[</span><span class="ot">section on marginal distributions</span><span class="co">](#marginal-distribution)</span>, we often have an analytically intractable marginal distribution, which means we cannot get a closed-form solution for the posterior distribution<span class="ot">[^intro-11]</span>. Markov Chain Monte Carlo (MCMC) methods allow us to sample from the posterior distribution, and we can perform our inference based on numerical integration of the sample, rather than analytical integration when the closed-form is known.</span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-11]: </span>Our examples here have been simple and used <span class="co">[</span><span class="ot">conjugate priors</span><span class="co">](https://en.wikipedia.org/wiki/Conjugate_prior)</span>, so we have been able to find a closed-form solution for the posterior. This is rarely the case in our real-life problems in the PK/PD world.</span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a>Traditional Monte Carlo methods include the <span class="co">[</span><span class="ot">Gibbs sampler</span><span class="co">](https://en.wikipedia.org/wiki/Gibbs_sampling)</span> and <span class="co">[</span><span class="ot">Metropolis-Hastings</span><span class="co">](https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm)</span>. These methods are fast and easy-to-implement, but often lead to inefficient sampling from the posterior. <span class="co">[</span><span class="ot">Stan</span><span class="co">](https://mc-stan.org/)</span><span class="ot">[^intro-12]</span> implements a more modern method called the <span class="co">[</span><span class="ot">No U-Turn Sampler</span><span class="co">](https://arxiv.org/abs/1111.4246)</span> (NUTS) that is itself an extension of <span class="co">[</span><span class="ot">Hamiltonian Monte Carlo</span><span class="co">](https://en.wikipedia.org/wiki/Hamiltonian_Monte_Carlo)</span>. While more computationally intensive than Gibbs sampling or Metropolis-Hastings, it samples more efficiently from the posterior than those more traditional methods.</span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-12]: </span>Python also has a NUTS implementation in the <span class="co">[</span><span class="ot">PyMC</span><span class="co">](https://www.pymc.io/welcome.html)</span> package. Julia has a NUTS implementation in the <span class="co">[</span><span class="ot">Turing</span><span class="co">](https://turing.ml/stable/)</span> package, NONMEM also can sample from the posterior using either M-H and Gibbs with the BAYES method or using NUTS with the NUTS method.</span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="fu">### MCMC - An Illustration</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a>Let's assume we know the posterior density up to a constant, as in @eq-up-to-constant):</span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-illustration-truth, cache=TRUE, echo=FALSE}</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.35</span>, <span class="fl">0.45</span>)</span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a>normal_mixture <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, probs, means, sds){</span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a>  density <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"double"</span>, <span class="at">length =</span> <span class="fu">length</span>(theta))</span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta)){</span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a>    density[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(probs<span class="sc">*</span><span class="fu">dnorm</span>(theta[i], means, sds))</span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(density)</span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a>density <span class="ot">&lt;-</span> <span class="fu">normal_mixture</span>(<span class="at">theta =</span> theta, <span class="at">probs =</span> probs, <span class="at">means =</span> means, </span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sds =</span> sds)</span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a>data_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">theta =</span> theta, <span class="at">density =</span> density)</span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_1) <span class="sc">+</span></span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>) </span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>Since we don't have the marginal distribution, we can't analytically integrate our posterior, but we can sample from it using MCMC methods:</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-illustration-sample, cache=TRUE, eval=TRUE, include=FALSE}</span></span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a>stan_code <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a><span class="st">data{</span></span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower = 1&gt; n; // number of modes</span></span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a><span class="st">  // int&lt;lower = 1&gt; x; // x-values for the density </span></span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n] probs;   // probabilities</span></span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a><span class="st">  array[n] real means; // means</span></span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a><span class="st">  array[n] real sds;   // standard deviations</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a><span class="st">  int z = categorical_rng(probs);</span></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a><span class="st">  real theta = normal_rng(means[z], sds[z]);</span></span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">length</span>(probs),</span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a>                  <span class="at">probs =</span> probs,</span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a>                  <span class="at">means =</span> means,</span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sds =</span> sds)</span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">write_stan_file</span>(stan_code))</span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> model<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> stan_data,</span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed_param =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a>                        <span class="at">iter_warmup =</span> <span class="dv">0</span>,</span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a>                        <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a>                        <span class="at">chains =</span> <span class="dv">4</span>) </span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> samples<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>, <span class="at">format =</span> <span class="st">"draws_df"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(.chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">iteration =</span> <span class="st">".iteration"</span>,</span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a>         <span class="at">draw =</span> <span class="st">".draw"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.chain)</span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a><span class="al">![](Videos/samples_falling_drops.mp4)</span>{width="600" height="450"}</span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a>In practice we use multiple chains to sample from the target distribution:</span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gif-4-chains, fig.align="center", eval=FALSE, cache=TRUE}</span></span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- time series</span></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a>static_tsplot <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Chain =</span> <span class="st">"chain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> theta, <span class="at">group =</span> Chain, <span class="at">color =</span> Chain)) <span class="sc">+</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">"Chain"</span>, </span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Chain"</span>, <span class="at">x =</span> <span class="st">"Iteration"</span>, <span class="at">y =</span> <span class="st">"\U03B8"</span>) <span class="sc">+</span></span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Chain, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">labeller =</span> label_both)</span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a><span class="co"># animate</span></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a>animated_tsplot <span class="ot">&lt;-</span> static_tsplot <span class="sc">+</span></span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(<span class="at">along =</span> iteration, </span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">max</span>(df<span class="sc">$</span>iteration) <span class="sc">+</span> <span class="dv">50</span>))) </span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a>a_gif <span class="ot">&lt;-</span> <span class="fu">animate</span>(animated_tsplot,</span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">600</span>, </span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a>                 <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- histogram</span></span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a>static_hist <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Chain =</span> <span class="st">"chain"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accumulate</span>(<span class="sc">~</span> <span class="fu">bind_rows</span>(.x, .y)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"frame"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frame =</span> <span class="fu">as.integer</span>(frame)) <span class="sc">%&gt;%</span></span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">fill =</span> Chain)) <span class="sc">+</span></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="co">#aes(y = ..density..), </span></span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bins =</span> <span class="dv">15</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"\U03B8"</span>, <span class="at">fill =</span> <span class="st">"Chain"</span>) <span class="sc">+</span></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Chain, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">labeller =</span> label_both) </span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a><span class="co"># animate</span></span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a>anim_hist <span class="ot">&lt;-</span> static_hist <span class="sc">+</span> </span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_manual</span>(frame) <span class="sc">+</span></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">"linear"</span>) <span class="sc">+</span></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_fade</span>() <span class="sc">+</span></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exit_fade</span>()</span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a>b_gif <span class="ot">&lt;-</span> <span class="fu">animate</span>(anim_hist,</span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="dv">600</span>, </span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a>                 <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a>a_mgif <span class="ot">&lt;-</span> <span class="fu">image_read</span>(a_gif)</span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a>b_mgif <span class="ot">&lt;-</span> <span class="fu">image_read</span>(b_gif)</span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a><span class="co">#---------- put side-by-side</span></span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a>new_gif <span class="ot">&lt;-</span> <span class="fu">image_append</span>(<span class="fu">c</span>(a_mgif[<span class="dv">1</span>], b_mgif[<span class="dv">1</span>]))</span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">min</span>(<span class="fu">length</span>(a_mgif))){</span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">image_append</span>(<span class="fu">c</span>(a_mgif[i], b_mgif[i]))</span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a>  new_gif <span class="ot">&lt;-</span> <span class="fu">c</span>(new_gif, combined)</span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a>new_gif</span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a><span class="al">![](Videos/new_gif.gif)</span></span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a>When we have collected all of our samples, we combine the chains, and the resulting samples should be distributed according to the true posterior:</span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mcmc-illustration-hist, cache=TRUE, fig.align='center', fig.cap="Samples overlayed with the true distribution."}</span></span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_hist</span>(samples<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">freq =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> data_1, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"\U03B8"</span>)</span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a><span class="fu">### MCMC for Our Examples</span></span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a>Our examples are very simple and have a simple closed form for the posterior distribution (see <span class="co">[</span><span class="ot">Appendix B</span><span class="co">](#appendix-b)</span>) and posterior predictive distribution (see <span class="co">[</span><span class="ot">Appendix C</span><span class="co">](#appendix-c)</span>). But let's imagine the marginal distribution was intractable, and we weren't able to find the closed form for the posterior. We'll write the model in Stan and then sample from the posterior.</span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{stan stan-model, output.var="model_beta_binomial", cache=TRUE}</span></span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a><span class="in">data{</span></span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower = 0&gt; x; // observed positive responses</span></span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower = x&gt; n; // number of responses</span></span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb27-759"><a href="#cb27-759" aria-hidden="true" tabindex="-1"></a><span class="in">  real&lt;lower = 0&gt; alpha; // Value of alpha for the prior distribution</span></span>
<span id="cb27-760"><a href="#cb27-760" aria-hidden="true" tabindex="-1"></a><span class="in">  real&lt;lower = 0&gt; beta;  // Value of beta for the prior distribution</span></span>
<span id="cb27-761"><a href="#cb27-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-762"><a href="#cb27-762" aria-hidden="true" tabindex="-1"></a><span class="in">  int n_new;               // length of new n values you want to simulate for </span></span>
<span id="cb27-763"><a href="#cb27-763" aria-hidden="true" tabindex="-1"></a><span class="in">  array[n_new] int n_star; // Number of future respondents for posterior predictions</span></span>
<span id="cb27-764"><a href="#cb27-764" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb27-765"><a href="#cb27-765" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb27-766"><a href="#cb27-766" aria-hidden="true" tabindex="-1"></a><span class="in">parameters{</span></span>
<span id="cb27-767"><a href="#cb27-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-768"><a href="#cb27-768" aria-hidden="true" tabindex="-1"></a><span class="in">  real&lt;lower = 0, upper = 1&gt; theta;</span></span>
<span id="cb27-769"><a href="#cb27-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-770"><a href="#cb27-770" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb27-771"><a href="#cb27-771" aria-hidden="true" tabindex="-1"></a><span class="in">model{</span></span>
<span id="cb27-772"><a href="#cb27-772" aria-hidden="true" tabindex="-1"></a><span class="in">  // Priors</span></span>
<span id="cb27-773"><a href="#cb27-773" aria-hidden="true" tabindex="-1"></a><span class="in">  theta ~ beta(alpha, beta);</span></span>
<span id="cb27-774"><a href="#cb27-774" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb27-775"><a href="#cb27-775" aria-hidden="true" tabindex="-1"></a><span class="in">  // Likelihood</span></span>
<span id="cb27-776"><a href="#cb27-776" aria-hidden="true" tabindex="-1"></a><span class="in">  x ~ binomial(n, theta);</span></span>
<span id="cb27-777"><a href="#cb27-777" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb27-778"><a href="#cb27-778" aria-hidden="true" tabindex="-1"></a><span class="in">generated quantities{</span></span>
<span id="cb27-779"><a href="#cb27-779" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb27-780"><a href="#cb27-780" aria-hidden="true" tabindex="-1"></a><span class="in">  array[n_new] int x_star = binomial_rng(n_star, theta); </span></span>
<span id="cb27-781"><a href="#cb27-781" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb27-782"><a href="#cb27-782" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb27-783"><a href="#cb27-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-784"><a href="#cb27-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-785"><a href="#cb27-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-786"><a href="#cb27-786" aria-hidden="true" tabindex="-1"></a><span class="in">```{r stan-fit}</span></span>
<span id="cb27-787"><a href="#cb27-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-788"><a href="#cb27-788" aria-hidden="true" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb27-789"><a href="#cb27-789" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">6</span>,</span>
<span id="cb27-790"><a href="#cb27-790" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="dv">2</span>,</span>
<span id="cb27-791"><a href="#cb27-791" aria-hidden="true" tabindex="-1"></a>                  <span class="at">beta =</span> <span class="dv">3</span>,</span>
<span id="cb27-792"><a href="#cb27-792" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_new =</span> <span class="dv">2</span>,</span>
<span id="cb27-793"><a href="#cb27-793" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_star =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>))</span>
<span id="cb27-794"><a href="#cb27-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-795"><a href="#cb27-795" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> model_beta_binomial<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> stan_data,</span>
<span id="cb27-796"><a href="#cb27-796" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb27-797"><a href="#cb27-797" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb27-798"><a href="#cb27-798" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb27-799"><a href="#cb27-799" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">refresh =</span> <span class="dv">0</span>) </span>
<span id="cb27-800"><a href="#cb27-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-801"><a href="#cb27-801" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> <span class="fu">summarize_draws</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), </span>
<span id="cb27-802"><a href="#cb27-802" aria-hidden="true" tabindex="-1"></a>                           mean, median, sd, <span class="at">pr_gt_half =</span> <span class="sc">~</span> <span class="fu">mean</span>(. <span class="sc">&gt;=</span> <span class="fl">0.5</span>),</span>
<span id="cb27-803"><a href="#cb27-803" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">~</span><span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), rhat,</span>
<span id="cb27-804"><a href="#cb27-804" aria-hidden="true" tabindex="-1"></a>                           ess_bulk, ess_tail)</span>
<span id="cb27-805"><a href="#cb27-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-806"><a href="#cb27-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-807"><a href="#cb27-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-808"><a href="#cb27-808" aria-hidden="true" tabindex="-1"></a>Now we can perform inference using our samples. We can look at the full posterior distributions with either histograms or density plots:</span>
<span id="cb27-809"><a href="#cb27-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-810"><a href="#cb27-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sample-posterior-distribution, cache=TRUE, fig.width=9, fig.height=9, fig.align="center"}</span></span>
<span id="cb27-811"><a href="#cb27-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-812"><a href="#cb27-812" aria-hidden="true" tabindex="-1"></a><span class="fu">color_scheme_set</span>(<span class="st">"blue"</span>)</span>
<span id="cb27-813"><a href="#cb27-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-814"><a href="#cb27-814" aria-hidden="true" tabindex="-1"></a>post_hist <span class="ot">&lt;-</span> <span class="fu">mcmc_hist</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">freq =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-816"><a href="#cb27-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb27-817"><a href="#cb27-817" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb27-818"><a href="#cb27-818" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb27-819"><a href="#cb27-819" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb27-820"><a href="#cb27-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-821"><a href="#cb27-821" aria-hidden="true" tabindex="-1"></a>post_dens <span class="ot">&lt;-</span> <span class="fu">mcmc_dens</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>)) <span class="sc">+</span></span>
<span id="cb27-822"><a href="#cb27-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-823"><a href="#cb27-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb27-824"><a href="#cb27-824" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb27-825"><a href="#cb27-825" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb27-826"><a href="#cb27-826" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb27-827"><a href="#cb27-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-828"><a href="#cb27-828" aria-hidden="true" tabindex="-1"></a>post_hist <span class="sc">/</span></span>
<span id="cb27-829"><a href="#cb27-829" aria-hidden="true" tabindex="-1"></a>  post_dens</span>
<span id="cb27-830"><a href="#cb27-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-831"><a href="#cb27-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-832"><a href="#cb27-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-833"><a href="#cb27-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-834"><a href="#cb27-834" aria-hidden="true" tabindex="-1"></a>We can also make similar inferences as before:</span>
<span id="cb27-835"><a href="#cb27-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-836"><a href="#cb27-836" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Point estimates - for these samples, the posterior <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"red"</span><span class="kw">&gt;</span>mean<span class="kw">&lt;/font&gt;</span> and <span class="kw">&lt;font</span> <span class="er">color</span><span class="ot">=</span><span class="st">"purple"</span><span class="kw">&gt;</span>median<span class="kw">&lt;/font&gt;</span> are <span class="in">`r round(summary$mean, 3)`</span> and <span class="in">`r round(summary$median, 3)`</span>, respectively.</span>
<span id="cb27-837"><a href="#cb27-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-838"><a href="#cb27-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-inference, cache=TRUE, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-839"><a href="#cb27-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-840"><a href="#cb27-840" aria-hidden="true" tabindex="-1"></a>post_dens <span class="sc">+</span></span>
<span id="cb27-841"><a href="#cb27-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> summary <span class="sc">%&gt;%</span> </span>
<span id="cb27-842"><a href="#cb27-842" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(mean, median) <span class="sc">%&gt;%</span> </span>
<span id="cb27-843"><a href="#cb27-843" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename_all</span>(str_to_title) <span class="sc">%&gt;%</span> </span>
<span id="cb27-844"><a href="#cb27-844" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(Mean<span class="sc">:</span>Median, <span class="at">names_to =</span> <span class="st">"Estimate"</span>), </span>
<span id="cb27-845"><a href="#cb27-845" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> Estimate),</span>
<span id="cb27-846"><a href="#cb27-846" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.15</span>) <span class="sc">+</span></span>
<span id="cb27-847"><a href="#cb27-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Point Estimate"</span>,</span>
<span id="cb27-848"><a href="#cb27-848" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>),</span>
<span id="cb27-849"><a href="#cb27-849" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Median"</span>),</span>
<span id="cb27-850"><a href="#cb27-850" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"purple"</span>))</span>
<span id="cb27-851"><a href="#cb27-851" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-852"><a href="#cb27-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-853"><a href="#cb27-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-854"><a href="#cb27-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-855"><a href="#cb27-855" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The posterior standard deviation for $\theta$ is <span class="in">`r round(summary$sd, 3)`</span>.</span>
<span id="cb27-856"><a href="#cb27-856" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interval estimates</span>
<span id="cb27-857"><a href="#cb27-857" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>95% credible interval - "There is a 95% chance that the true proportion of people who like Mt. Dew cheesecake is between <span class="in">`r summary$q2.5 %&gt;% round(3)`</span> and <span class="in">`r summary$q97.5 %&gt;% round(3)`</span>."</span>
<span id="cb27-858"><a href="#cb27-858" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>"There is an <span class="in">`r round(summary$pr_gt_half*100, 2)`</span>% chance that the true proportion of people who like Mt. Dew cheesecake is at least 0.5."</span>
<span id="cb27-859"><a href="#cb27-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-860"><a href="#cb27-860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sample-interval-plots, fig.width=11, fig.align="center", cache=TRUE}</span></span>
<span id="cb27-861"><a href="#cb27-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-862"><a href="#cb27-862" aria-hidden="true" tabindex="-1"></a>x_ticks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(summary<span class="sc">$</span>q2<span class="fl">.5</span>, summary<span class="sc">$</span>q97<span class="fl">.5</span>,</span>
<span id="cb27-863"><a href="#cb27-863" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.25</span>)))</span>
<span id="cb27-864"><a href="#cb27-864" aria-hidden="true" tabindex="-1"></a>tick_colors <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x_ticks <span class="sc">%in%</span> <span class="fu">c</span>(summary<span class="sc">$</span>q2<span class="fl">.5</span>, summary<span class="sc">$</span>q97<span class="fl">.5</span>), </span>
<span id="cb27-865"><a href="#cb27-865" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb27-866"><a href="#cb27-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-867"><a href="#cb27-867" aria-hidden="true" tabindex="-1"></a>sample_ci <span class="ot">&lt;-</span> <span class="fu">mcmc_areas</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">point_est =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb27-868"><a href="#cb27-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"95% credible interval"</span>) <span class="sc">+</span></span>
<span id="cb27-869"><a href="#cb27-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb27-870"><a href="#cb27-870" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> x_ticks,</span>
<span id="cb27-871"><a href="#cb27-871" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(x_ticks, <span class="dv">3</span>)),</span>
<span id="cb27-872"><a href="#cb27-872" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb27-873"><a href="#cb27-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">breaks =</span> <span class="st">"theta"</span>,</span>
<span id="cb27-874"><a href="#cb27-874" aria-hidden="true" tabindex="-1"></a>                   <span class="at">limits =</span> <span class="st">"theta"</span>,</span>
<span id="cb27-875"><a href="#cb27-875" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"theta"</span> <span class="ot">=</span> <span class="st">""</span>),</span>
<span id="cb27-876"><a href="#cb27-876" aria-hidden="true" tabindex="-1"></a>                   <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb27-877"><a href="#cb27-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> tick_colors),</span>
<span id="cb27-878"><a href="#cb27-878" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb27-879"><a href="#cb27-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-880"><a href="#cb27-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-881"><a href="#cb27-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-882"><a href="#cb27-882" aria-hidden="true" tabindex="-1"></a>blah <span class="ot">&lt;-</span> <span class="fu">mcmc_dens</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>), <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb27-883"><a href="#cb27-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"P(\U03B8 &gt; 0.50 | X = 5)"</span>) <span class="sc">+</span></span>
<span id="cb27-884"><a href="#cb27-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb27-885"><a href="#cb27-885" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb27-886"><a href="#cb27-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb27-887"><a href="#cb27-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-888"><a href="#cb27-888" aria-hidden="true" tabindex="-1"></a>blah_d <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(blah)<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb27-889"><a href="#cb27-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-890"><a href="#cb27-890" aria-hidden="true" tabindex="-1"></a>sample_gt_half <span class="ot">&lt;-</span> blah <span class="sc">+</span></span>
<span id="cb27-891"><a href="#cb27-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> <span class="fu">subset</span>(blah_d, x <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"blue"</span>, </span>
<span id="cb27-892"><a href="#cb27-892" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.25</span>)</span>
<span id="cb27-893"><a href="#cb27-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-894"><a href="#cb27-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-895"><a href="#cb27-895" aria-hidden="true" tabindex="-1"></a>sample_ci <span class="sc">+</span></span>
<span id="cb27-896"><a href="#cb27-896" aria-hidden="true" tabindex="-1"></a>  sample_gt_half</span>
<span id="cb27-897"><a href="#cb27-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-898"><a href="#cb27-898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-899"><a href="#cb27-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-900"><a href="#cb27-900" aria-hidden="true" tabindex="-1"></a>We can look at the posterior predictive distribution<span class="ot">[^intro-13]</span> for $n^* = 6$ and $n^* = 10$:</span>
<span id="cb27-901"><a href="#cb27-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-902"><a href="#cb27-902" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-13]: </span>With $n^* = 6 = n$, we are also doing a *posterior predictive check (PPC)*. The idea of PPC is that if a model is a good fit, then we should be able to use it to generate data that looks a lot like the data we observed.</span>
<span id="cb27-903"><a href="#cb27-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-904"><a href="#cb27-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sample-ppd, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-905"><a href="#cb27-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-906"><a href="#cb27-906" aria-hidden="true" tabindex="-1"></a>(p_sample_ppd <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"draws_df"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-907"><a href="#cb27-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(x_star[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb27-908"><a href="#cb27-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-909"><a href="#cb27-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_star =</span> stan_data<span class="sc">$</span>n_star[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb27-910"><a href="#cb27-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-911"><a href="#cb27-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_star, <span class="at">group =</span> n_star, <span class="at">y =</span> ..prop..)) <span class="sc">+</span></span>
<span id="cb27-912"><a href="#cb27-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$x^*$"</span>),</span>
<span id="cb27-913"><a href="#cb27-913" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(stan_data<span class="sc">$</span>n_star),</span>
<span id="cb27-914"><a href="#cb27-914" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(stan_data<span class="sc">$</span>n_star)) <span class="sc">+</span></span>
<span id="cb27-915"><a href="#cb27-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$p(x^* | </span><span class="sc">\\</span><span class="st">; x) = P(X^*= x^* | </span><span class="sc">\\</span><span class="st">; x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-916"><a href="#cb27-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Posterior Predictive Density"</span>) <span class="sc">+</span></span>
<span id="cb27-917"><a href="#cb27-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb27-918"><a href="#cb27-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n_star, <span class="at">scales =</span> <span class="st">"free_x"</span>, </span>
<span id="cb27-919"><a href="#cb27-919" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(n<span class="sc">^</span><span class="st">"*"</span> <span class="sc">==</span> .(n_star))))</span>
<span id="cb27-920"><a href="#cb27-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-921"><a href="#cb27-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-922"><a href="#cb27-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-923"><a href="#cb27-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-924"><a href="#cb27-924" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comparison with the Analytical Posterior</span></span>
<span id="cb27-925"><a href="#cb27-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-926"><a href="#cb27-926" aria-hidden="true" tabindex="-1"></a>To compare the true, analytical posterior with the sampled posterior we can look at the full densities:</span>
<span id="cb27-927"><a href="#cb27-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-928"><a href="#cb27-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-comparison-density, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-929"><a href="#cb27-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-930"><a href="#cb27-930" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens</span>(fit<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"theta"</span>)) <span class="sc">+</span></span>
<span id="cb27-931"><a href="#cb27-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_all <span class="sc">%&gt;%</span> </span>
<span id="cb27-932"><a href="#cb27-932" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(example <span class="sc">==</span> <span class="st">"posterior_2_1"</span>),</span>
<span id="cb27-933"><a href="#cb27-933" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-934"><a href="#cb27-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">str_c</span>(<span class="st">"p(\U03B8 | x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-935"><a href="#cb27-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"\U03B8"</span>,</span>
<span id="cb27-936"><a href="#cb27-936" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb27-937"><a href="#cb27-937" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb27-938"><a href="#cb27-938" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb27-939"><a href="#cb27-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-940"><a href="#cb27-940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-941"><a href="#cb27-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-942"><a href="#cb27-942" aria-hidden="true" tabindex="-1"></a>and posterior parameter and quantile estimates:</span>
<span id="cb27-943"><a href="#cb27-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-944"><a href="#cb27-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-comparison-table}</span></span>
<span id="cb27-945"><a href="#cb27-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-946"><a href="#cb27-946" aria-hidden="true" tabindex="-1"></a>mcmc_estimates <span class="ot">&lt;-</span> summary <span class="sc">%&gt;%</span> </span>
<span id="cb27-947"><a href="#cb27-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(mean, median, sd, <span class="fu">starts_with</span>(<span class="st">"q"</span>)), </span>
<span id="cb27-948"><a href="#cb27-948" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"MCMC"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-949"><a href="#cb27-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Variable, MCMC) </span>
<span id="cb27-950"><a href="#cb27-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-951"><a href="#cb27-951" aria-hidden="true" tabindex="-1"></a>analytical_estimates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Variable =</span> mcmc_estimates<span class="sc">$</span>Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb27-952"><a href="#cb27-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Analytical =</span> <span class="fu">case_when</span>(Variable <span class="sc">==</span> <span class="st">"mean"</span> <span class="sc">~</span> </span>
<span id="cb27-953"><a href="#cb27-953" aria-hidden="true" tabindex="-1"></a>                                  (alpha_2 <span class="sc">+</span> x_1)<span class="sc">/</span>(alpha_2 <span class="sc">+</span> x_1 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-954"><a href="#cb27-954" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"median"</span> <span class="sc">~</span> </span>
<span id="cb27-955"><a href="#cb27-955" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">qbeta</span>(<span class="fl">0.5</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-956"><a href="#cb27-956" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"sd"</span> <span class="sc">~</span></span>
<span id="cb27-957"><a href="#cb27-957" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">sqrt</span>((alpha_2 <span class="sc">+</span> x_1)<span class="sc">*</span>(beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1)<span class="sc">/</span></span>
<span id="cb27-958"><a href="#cb27-958" aria-hidden="true" tabindex="-1"></a>                                         ((alpha_2 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(alpha_2 <span class="sc">+</span> beta_2 <span class="sc">+</span> n_1 <span class="sc">+</span> <span class="dv">1</span>))),</span>
<span id="cb27-959"><a href="#cb27-959" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"q2.5"</span> <span class="sc">~</span></span>
<span id="cb27-960"><a href="#cb27-960" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">qbeta</span>(<span class="fl">0.025</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-961"><a href="#cb27-961" aria-hidden="true" tabindex="-1"></a>                                Variable <span class="sc">==</span> <span class="st">"q97.5"</span> <span class="sc">~</span></span>
<span id="cb27-962"><a href="#cb27-962" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">qbeta</span>(<span class="fl">0.975</span>, alpha_2 <span class="sc">+</span> x_1, beta_2 <span class="sc">+</span> n_1 <span class="sc">-</span> x_1),</span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-965"><a href="#cb27-965" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> analytical_estimates <span class="sc">%&gt;%</span> </span>
<span id="cb27-966"><a href="#cb27-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(mcmc_estimates, <span class="at">by =</span> <span class="st">"Variable"</span>) </span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a>estimates <span class="sc">%&gt;%</span> </span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">3</span>),</span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a>         <span class="at">Variable =</span> <span class="fu">case_when</span>(Variable <span class="sc">==</span> <span class="st">"mean"</span> <span class="sc">~</span> <span class="st">"Mean"</span>,</span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"median"</span> <span class="sc">~</span> <span class="st">"Median"</span>,</span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"sd"</span> <span class="sc">~</span> <span class="st">"Std. Dev."</span>,</span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"q2.5"</span> <span class="sc">~</span> <span class="st">"2.5th percentile"</span>,</span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a>                              Variable <span class="sc">==</span> <span class="st">"q97.5"</span> <span class="sc">~</span> <span class="st">"97.5th percentile"</span>,</span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kbl(caption = "&lt;center&gt;Posterior Estimates for &amp;theta;&lt;center&gt;") %&gt;%</span></span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">"Posterior Estimates for \U03B8"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Estimate"</span> <span class="ot">=</span> <span class="dv">2</span>))</span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a>and the posterior predictive densities:</span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a><span class="in">```{r posterior-comparison-ppd, fig.width=11, fig.align="center"}</span></span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(p_sample_ppd)<span class="sc">$</span>data[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"MCMC"</span>)</span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(p_analytical_ppd)<span class="sc">$</span>data[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Analytical"</span>)</span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(d1, d2) <span class="sc">%&gt;%</span> </span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y, type) <span class="sc">%&gt;%</span> </span>
<span id="cb27-996"><a href="#cb27-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_star =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(n_star[<span class="dv">1</span>], <span class="at">times =</span> n_star[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb27-997"><a href="#cb27-997" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">rep</span>(n_star[<span class="dv">2</span>], <span class="at">times =</span> n_star[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span>)), <span class="at">times =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">group =</span> type, <span class="at">fill =</span> type),</span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$x^*$"</span>),</span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star),</span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(n_star)) <span class="sc">+</span></span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-1005"><a href="#cb27-1005" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Analytical"</span>, <span class="st">"MCMC"</span>),</span>
<span id="cb27-1006"><a href="#cb27-1006" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">"$p(x^* | </span><span class="sc">\\</span><span class="st">; x) = P(X^*= x^* | </span><span class="sc">\\</span><span class="st">; x)"</span>)) <span class="sc">+</span></span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Posterior Predictive Density"</span>) <span class="sc">+</span></span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n_star, <span class="at">scales =</span> <span class="st">"free_x"</span>, </span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(n<span class="sc">^</span><span class="st">"*"</span> <span class="sc">==</span> .(n_star)))</span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a>You can see that all posterior quantities are similar between the analytical solutions and those estimated through MCMC.</span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary/tl;dr</span></span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Classical methods find point estimates through optimization of some objective function (often some function of the likelihood) and quantify uncertainty by examining the curvature of the likelihood at the point estimate.</span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Bayesian methods quantify our knowledge about the parameter(s) with a *distribution*. From this distribution, we can obtain point estimates, uncertainty estimates, and make predictions for future data.</span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The posterior distribution is a combination of our prior distribution and the data and contains all of our knowledge about the parameter(s).</span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The likelihood contains all of the information from the data.</span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The use of the prior distribution can range from being a nuisance that serves simply as a catalyst that allows us to express uncertainty via Bayes'theorem to a means to stabilize the sampling algorithm to actually incorporating knowledge about the parameter(s) before collecting data.</span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We often can't get the posterior distribution in closed-form, but we can generally use Markov Chain Monte Carlo methods to obtain a sample that approximates the posterior.</span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stan is a great tool for performing the MCMC sampling.</span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1034"><a href="#cb27-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendices</span></span>
<span id="cb27-1035"><a href="#cb27-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1036"><a href="#cb27-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">### Appendix A - More on the Marginal Distribution {#appendix-a}</span></span>
<span id="cb27-1037"><a href="#cb27-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1038"><a href="#cb27-1038" aria-hidden="true" tabindex="-1"></a>While the marginal distribution is often analytically intractable, there are some cases where we can find the closed form. For our examples, we have assumed $$\begin{align}</span>
<span id="cb27-1039"><a href="#cb27-1039" aria-hidden="true" tabindex="-1"></a>X|\theta &amp;\sim Binomial(n, \; \theta) <span class="sc">\\</span></span>
<span id="cb27-1040"><a href="#cb27-1040" aria-hidden="true" tabindex="-1"></a>\theta &amp;\sim Beta(\alpha, \; \beta)</span>
<span id="cb27-1041"><a href="#cb27-1041" aria-hidden="true" tabindex="-1"></a>\end{align}$$ Then $$\begin{align}</span>
<span id="cb27-1042"><a href="#cb27-1042" aria-hidden="true" tabindex="-1"></a>f(x) &amp;= \int \limits_{\Theta} p\left( x, \; \theta \right) \; \mathrm{d}\theta <span class="sc">\\</span></span>
<span id="cb27-1043"><a href="#cb27-1043" aria-hidden="true" tabindex="-1"></a>&amp;= \int \limits_{\Theta}f\left( x | \theta\right) p\left( \theta \right) \;</span>
<span id="cb27-1044"><a href="#cb27-1044" aria-hidden="true" tabindex="-1"></a>\mathrm{d}\theta  \notag <span class="sc">\\</span></span>
<span id="cb27-1045"><a href="#cb27-1045" aria-hidden="true" tabindex="-1"></a>&amp;= \int_0^1 {n \choose x}\theta^x(1 - \theta)^{n-x} </span>
<span id="cb27-1046"><a href="#cb27-1046" aria-hidden="true" tabindex="-1"></a>\frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\Gamma(\beta)} </span>
<span id="cb27-1047"><a href="#cb27-1047" aria-hidden="true" tabindex="-1"></a>\theta^{\alpha - 1}(1 - \theta)^{\beta - 1} \; \mathrm{d}\theta \notag <span class="sc">\\</span></span>
<span id="cb27-1048"><a href="#cb27-1048" aria-hidden="true" tabindex="-1"></a>&amp;= {n \choose x} \frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha) \; \Gamma(\beta)} </span>
<span id="cb27-1049"><a href="#cb27-1049" aria-hidden="true" tabindex="-1"></a>\frac{\Gamma(\alpha + x) \; </span>
<span id="cb27-1050"><a href="#cb27-1050" aria-hidden="true" tabindex="-1"></a>\Gamma(\beta + n - x)}{\Gamma(\alpha + \beta + n)} \notag <span class="sc">\\</span></span>
<span id="cb27-1051"><a href="#cb27-1051" aria-hidden="true" tabindex="-1"></a>&amp;= {n \choose x} \frac{B(\alpha + x, \; \beta + n - x)}{B(\alpha, \; \beta)},</span>
<span id="cb27-1052"><a href="#cb27-1052" aria-hidden="true" tabindex="-1"></a>\; x \in <span class="sc">\{</span>0, 1, \ldots, n<span class="sc">\}</span>, \;\;\; \alpha, \; \beta &gt; 0</span>
<span id="cb27-1053"><a href="#cb27-1053" aria-hidden="true" tabindex="-1"></a>\end{align}$$ {#eq-beta-binomial} a <span class="co">[</span><span class="ot">beta-binomial</span><span class="co">](https://en.wikipedia.org/wiki/Beta-binomial_distribution)</span> distribution<span class="ot">[^intro-14]</span>.</span>
<span id="cb27-1054"><a href="#cb27-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1055"><a href="#cb27-1055" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-14]: </span>The beta-binomial distribution is similar to the binomial distribution in that it gives the probability of observing $x$ successes in $n$ trials. However, while the binomial distribution considers $\theta$ fixed and known, the beta-binomial distribution assumes $\theta$ is either unknown or random and incorporates this uncertainty in $\theta$ by treating $\theta$ as a draw from a Beta distribution. This uncertainty in $\theta$ has the effect of giving the beta-binomial a slightly larger variance than the binomial</span>
<span id="cb27-1056"><a href="#cb27-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1057"><a href="#cb27-1057" aria-hidden="true" tabindex="-1"></a>If we assume the prior distribution $\theta \sim Beta(1, 1)$ to express our ignorance of $\theta$, then @eq-beta-binomial evaluates to $$f(x) = \frac{1}{n+1}, \; x = 0, 1, \ldots, n$$ the density for a discrete uniform.</span>
<span id="cb27-1058"><a href="#cb27-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1059"><a href="#cb27-1059" aria-hidden="true" tabindex="-1"></a>If we assume the prior distribution $\theta \sim Beta(2, 3)$ to express our prior knowledge of $\theta$, then $$\begin{align}</span>
<span id="cb27-1060"><a href="#cb27-1060" aria-hidden="true" tabindex="-1"></a>f(x) &amp;= \frac{n!}{x!\;(n-x)!}\;\frac{4!}{1!\;2!} \; </span>
<span id="cb27-1061"><a href="#cb27-1061" aria-hidden="true" tabindex="-1"></a>\frac{(x+1)! \; (n-x+2)!}{(n+4)!}, \;\; x = 0, 1, \ldots, n</span>
<span id="cb27-1062"><a href="#cb27-1062" aria-hidden="true" tabindex="-1"></a>\end{align}$$</span>
<span id="cb27-1063"><a href="#cb27-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1064"><a href="#cb27-1064" aria-hidden="true" tabindex="-1"></a>These two marginal distributions look like this (for Example 1 with $n = 6$):</span>
<span id="cb27-1065"><a href="#cb27-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1066"><a href="#cb27-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{r marginal-densities, fig.align="center", fig.cap="Two marginal densities."}</span></span>
<span id="cb27-1067"><a href="#cb27-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1068"><a href="#cb27-1068" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb27-1069"><a href="#cb27-1069" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n</span>
<span id="cb27-1070"><a href="#cb27-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1071"><a href="#cb27-1071" aria-hidden="true" tabindex="-1"></a>alpha_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-1072"><a href="#cb27-1072" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-1073"><a href="#cb27-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1074"><a href="#cb27-1074" aria-hidden="true" tabindex="-1"></a>alpha_2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb27-1075"><a href="#cb27-1075" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb27-1076"><a href="#cb27-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1077"><a href="#cb27-1077" aria-hidden="true" tabindex="-1"></a>dbetabinomial <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, alpha, beta){</span>
<span id="cb27-1078"><a href="#cb27-1078" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-1079"><a href="#cb27-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">choose</span>(n, x) <span class="sc">*</span> <span class="fu">beta</span>(alpha <span class="sc">+</span> x, beta <span class="sc">+</span> n <span class="sc">-</span> x)<span class="sc">/</span>(<span class="fu">beta</span>(alpha, beta)) </span>
<span id="cb27-1080"><a href="#cb27-1080" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-1081"><a href="#cb27-1081" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-1082"><a href="#cb27-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1083"><a href="#cb27-1083" aria-hidden="true" tabindex="-1"></a>marg_dists <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb27-1084"><a href="#cb27-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marginal_1 =</span> <span class="fu">dbetabinomial</span>(x, n, alpha_1, beta_1),</span>
<span id="cb27-1085"><a href="#cb27-1085" aria-hidden="true" tabindex="-1"></a>         <span class="at">marginal_2 =</span> <span class="fu">dbetabinomial</span>(x, n, alpha_2, beta_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-1086"><a href="#cb27-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(marginal_1, marginal_2), <span class="at">names_to =</span> <span class="st">"example"</span>, </span>
<span id="cb27-1087"><a href="#cb27-1087" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"density"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-1088"><a href="#cb27-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(example)</span>
<span id="cb27-1089"><a href="#cb27-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1090"><a href="#cb27-1090" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density,</span>
<span id="cb27-1091"><a href="#cb27-1091" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"x: "</span>, x, <span class="st">"&lt;/br&gt;&lt;/br&gt;density: "</span>,</span>
<span id="cb27-1092"><a href="#cb27-1092" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">round</span>(density, <span class="dv">3</span>)))) <span class="sc">+</span></span>
<span id="cb27-1093"><a href="#cb27-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"x"</span>,</span>
<span id="cb27-1094"><a href="#cb27-1094" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span>n,</span>
<span id="cb27-1095"><a href="#cb27-1095" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span>n) <span class="sc">+</span></span>
<span id="cb27-1096"><a href="#cb27-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Marginal Density"</span>) <span class="sc">+</span></span>
<span id="cb27-1097"><a href="#cb27-1097" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb27-1098"><a href="#cb27-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1099"><a href="#cb27-1099" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span></span>
<span id="cb27-1100"><a href="#cb27-1100" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(marg_dists, example <span class="sc">==</span> <span class="st">"marginal_1"</span>),</span>
<span id="cb27-1101"><a href="#cb27-1101" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-1102"><a href="#cb27-1102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-1103"><a href="#cb27-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"f(x) = P(X = x)"</span>)),</span>
<span id="cb27-1104"><a href="#cb27-1104" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb27-1105"><a href="#cb27-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1106"><a href="#cb27-1106" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> (base_plot <span class="sc">+</span></span>
<span id="cb27-1107"><a href="#cb27-1107" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">data =</span> <span class="fu">filter</span>(marg_dists, example <span class="sc">==</span> <span class="st">"marginal_2"</span>),</span>
<span id="cb27-1108"><a href="#cb27-1108" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="st">"identity"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-1109"><a href="#cb27-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>(<span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-1110"><a href="#cb27-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">"f(x) = P(X = x)"</span>)),</span>
<span id="cb27-1111"><a href="#cb27-1111" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"x"</span>))</span>
<span id="cb27-1112"><a href="#cb27-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1113"><a href="#cb27-1113" aria-hidden="true" tabindex="-1"></a>annot_base <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fl">1.0</span>,</span>
<span id="cb27-1114"><a href="#cb27-1114" aria-hidden="true" tabindex="-1"></a>                  <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb27-1115"><a href="#cb27-1115" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xref =</span> <span class="st">"paper"</span>,</span>
<span id="cb27-1116"><a href="#cb27-1116" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yref =</span> <span class="st">"paper"</span>,</span>
<span id="cb27-1117"><a href="#cb27-1117" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xanchor =</span> <span class="st">"center"</span>,</span>
<span id="cb27-1118"><a href="#cb27-1118" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yanchor =</span> <span class="st">"bottom"</span>,</span>
<span id="cb27-1119"><a href="#cb27-1119" aria-hidden="true" tabindex="-1"></a>                  <span class="at">showarrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-1120"><a href="#cb27-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1121"><a href="#cb27-1121" aria-hidden="true" tabindex="-1"></a>a_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb27-1122"><a href="#cb27-1122" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.225</span>,</span>
<span id="cb27-1123"><a href="#cb27-1123" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B1 = "</span>, alpha_1, <span class="st">", \U03B2 = "</span>, beta_1))</span>
<span id="cb27-1124"><a href="#cb27-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1125"><a href="#cb27-1125" aria-hidden="true" tabindex="-1"></a>a_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(annot_base,</span>
<span id="cb27-1126"><a href="#cb27-1126" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.775</span>,</span>
<span id="cb27-1127"><a href="#cb27-1127" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">str_c</span>(<span class="st">"\U03B1 = "</span>, alpha_2, <span class="st">", \U03B2 = "</span>, beta_2))</span>
<span id="cb27-1128"><a href="#cb27-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1129"><a href="#cb27-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(p1, p2, <span class="at">titleY =</span> <span class="cn">TRUE</span>, <span class="at">titleX =</span> <span class="cn">TRUE</span>, <span class="at">margin =</span> <span class="fl">0.08</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-1130"><a href="#cb27-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">annotations =</span> <span class="fu">list</span>(a_1, a_2))</span>
<span id="cb27-1131"><a href="#cb27-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1132"><a href="#cb27-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1133"><a href="#cb27-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1134"><a href="#cb27-1134" aria-hidden="true" tabindex="-1"></a>Stopping to think about this, these plots make sense: if we have no knowledge of $\theta$ (recall that a $Beta(1,1)$ distribution is "noninformative"), then any value of $x$ should be no more or less likely than any other possible value of $x$ conditional on our current knowledge of $\theta$. If we have some idea of $\theta$ (a $Beta(2, 3)$ describes our belief that it is likely that $\theta &lt; 0.5$, see @fig-beta-priors), then we would also expect the marginal distribution of $X$ to be skewed towards lower values, as seen above.</span>
<span id="cb27-1135"><a href="#cb27-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1136"><a href="#cb27-1136" aria-hidden="true" tabindex="-1"></a>Having integrated $\theta$ out of the joint distribution of $X$ and $\theta$, we can see that the marginal distribution is a constant in $\theta$. This constant is exactly the value needed to normalize the numerator in @eq-bayes-theorem, making the posterior distribution a true distribution.</span>
<span id="cb27-1137"><a href="#cb27-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1138"><a href="#cb27-1138" aria-hidden="true" tabindex="-1"></a>For example, if $\theta \sim Beta(1,1)$, then $p(\theta) = 1, \; 0 \leq \theta \leq 1$. So the numerator in @eq-bayes-theorem is $$\begin{align}</span>
<span id="cb27-1139"><a href="#cb27-1139" aria-hidden="true" tabindex="-1"></a>f(x \; | \; \theta)\;p(\theta) &amp;= f(x \;| \; \theta) \times 1 <span class="sc">\\</span></span>
<span id="cb27-1140"><a href="#cb27-1140" aria-hidden="true" tabindex="-1"></a>&amp;= f(x \; | \; \theta) <span class="sc">\\</span></span>
<span id="cb27-1141"><a href="#cb27-1141" aria-hidden="true" tabindex="-1"></a>&amp;= \mathcal{L}(\theta \; | \; x)</span>
<span id="cb27-1142"><a href="#cb27-1142" aria-hidden="true" tabindex="-1"></a>\end{align}$$ and we have already integrated our likelihoods for Examples 1 and 2 in @tbl-likelihood-integrals. If we divide the values in this table by $f(x) = \frac{1}{n+1}$ for the corresponding $n$, we get exactly 1 for both, i.e., we normalized the numerator, and so the posterior distribution is now a true distribution<span class="ot">[^intro-15]</span>.</span>
<span id="cb27-1143"><a href="#cb27-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1144"><a href="#cb27-1144" aria-hidden="true" tabindex="-1"></a><span class="ot">[^intro-15]: </span>The lack of normalization is why frequentist inference can't talk about the likelihood as a *distribution*</span>
<span id="cb27-1145"><a href="#cb27-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1146"><a href="#cb27-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">### Appendix B - Derivation of the Posterior in Our Examples {#appendix-b}</span></span>
<span id="cb27-1147"><a href="#cb27-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1148"><a href="#cb27-1148" aria-hidden="true" tabindex="-1"></a>For our examples, we have assumed $$\begin{align}</span>
<span id="cb27-1149"><a href="#cb27-1149" aria-hidden="true" tabindex="-1"></a>X|\theta &amp;\sim Binomial(n, \; \theta) <span class="sc">\\</span></span>
<span id="cb27-1150"><a href="#cb27-1150" aria-hidden="true" tabindex="-1"></a>\theta &amp;\sim Beta(\alpha, \; \beta)</span>
<span id="cb27-1151"><a href="#cb27-1151" aria-hidden="true" tabindex="-1"></a>\end{align}$$ Then $$\begin{align}</span>
<span id="cb27-1152"><a href="#cb27-1152" aria-hidden="true" tabindex="-1"></a>p( \theta \; | \; x) &amp;= </span>
<span id="cb27-1153"><a href="#cb27-1153" aria-hidden="true" tabindex="-1"></a>\frac{f( x \; | \; \theta)\; p( \theta )}{f\left( x \right)} \notag <span class="sc">\\</span></span>
<span id="cb27-1154"><a href="#cb27-1154" aria-hidden="true" tabindex="-1"></a>&amp;\propto f( x \; | \; \theta)\; p( \theta ) \notag <span class="sc">\\</span></span>
<span id="cb27-1155"><a href="#cb27-1155" aria-hidden="true" tabindex="-1"></a>&amp;= {n \choose x}\theta^x(1 - \theta)^{n-x} \; </span>
<span id="cb27-1156"><a href="#cb27-1156" aria-hidden="true" tabindex="-1"></a>\frac{\Gamma(\alpha + \beta)}{\Gamma(\alpha)\;\Gamma(\beta)} \;</span>
<span id="cb27-1157"><a href="#cb27-1157" aria-hidden="true" tabindex="-1"></a>\theta^{\alpha - 1}\;(1-\theta)^{\beta - 1} \notag <span class="sc">\\</span></span>
<span id="cb27-1158"><a href="#cb27-1158" aria-hidden="true" tabindex="-1"></a>&amp;\propto \theta^{\alpha + x - 1}\;(1 - \theta)^{\beta + n - x - 1} \notag <span class="sc">\\</span></span>
<span id="cb27-1159"><a href="#cb27-1159" aria-hidden="true" tabindex="-1"></a>&amp;\implies \theta\;|\;x \sim Beta(\alpha + x, \; \beta + n - x)</span>
<span id="cb27-1160"><a href="#cb27-1160" aria-hidden="true" tabindex="-1"></a>\end{align}$$</span>
<span id="cb27-1161"><a href="#cb27-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1162"><a href="#cb27-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">### Appendix C - Derivation of the Posterior Predictive Distribution in Our Examples {#appendix-c}</span></span>
<span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">Appendix B</span><span class="co">](#appendix-b)</span> we derived the posterior distribution of $\theta$. Here we will derive the posterior predictive distribution used for posterior predictive checking and to simulate/predict future data.</span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1166"><a href="#cb27-1166" aria-hidden="true" tabindex="-1"></a>After collecting $x$ positive responses out of $n$ respondents, we want the density for the number of positive responses, $x^*$, out of $n^*$ future respondents: $$\begin{align}</span>
<span id="cb27-1167"><a href="#cb27-1167" aria-hidden="true" tabindex="-1"></a>f(x^* | x) &amp;= \int \limits_{\Theta} p\left( x^*, \; \theta  | x \right) \; </span>
<span id="cb27-1168"><a href="#cb27-1168" aria-hidden="true" tabindex="-1"></a>\mathrm{d}\theta \notag <span class="sc">\\</span></span>
<span id="cb27-1169"><a href="#cb27-1169" aria-hidden="true" tabindex="-1"></a>&amp;= \int \limits_{\Theta}f\left( x^* | \theta, x \right) </span>
<span id="cb27-1170"><a href="#cb27-1170" aria-hidden="true" tabindex="-1"></a>p\left( \theta | x \right) \; \mathrm{d}\theta  \notag <span class="sc">\\</span></span>
<span id="cb27-1171"><a href="#cb27-1171" aria-hidden="true" tabindex="-1"></a>&amp;= \int \limits_{\Theta}f\left( x^* | \theta \right) </span>
<span id="cb27-1172"><a href="#cb27-1172" aria-hidden="true" tabindex="-1"></a>p\left( \theta | x \right) \; \mathrm{d}\theta <span class="sc">\\</span></span>
<span id="cb27-1173"><a href="#cb27-1173" aria-hidden="true" tabindex="-1"></a>&amp;= \int_0^1 {n^* \choose x^*}\theta^{x^*}(1 - \theta)^{n^* - x^*} </span>
<span id="cb27-1174"><a href="#cb27-1174" aria-hidden="true" tabindex="-1"></a>\frac{\Gamma(\alpha + \beta + n)}{\Gamma(\alpha + x)\Gamma(\beta + n - x)} </span>
<span id="cb27-1175"><a href="#cb27-1175" aria-hidden="true" tabindex="-1"></a>\theta^{\alpha + x - 1}(1 - \theta)^{\beta + n - x - 1} \; </span>
<span id="cb27-1176"><a href="#cb27-1176" aria-hidden="true" tabindex="-1"></a>\mathrm{d}\theta \notag <span class="sc">\\</span></span>
<span id="cb27-1177"><a href="#cb27-1177" aria-hidden="true" tabindex="-1"></a>&amp;= {n^* \choose x^*} \frac{\Gamma(\alpha + \beta + n)}{\Gamma(\alpha + x) \; \Gamma(\beta + n - x)} </span>
<span id="cb27-1178"><a href="#cb27-1178" aria-hidden="true" tabindex="-1"></a>\frac{\Gamma(\alpha + x + x^*) \; </span>
<span id="cb27-1179"><a href="#cb27-1179" aria-hidden="true" tabindex="-1"></a>\Gamma(\beta + n - x + n^* - x^*)}{\Gamma(\alpha + \beta + n + n^*)} \notag <span class="sc">\\</span></span>
<span id="cb27-1180"><a href="#cb27-1180" aria-hidden="true" tabindex="-1"></a>&amp;= {n^* \choose x^*} </span>
<span id="cb27-1181"><a href="#cb27-1181" aria-hidden="true" tabindex="-1"></a>\frac{B(\alpha + x + x^*, \; \beta + n - x + n^* - x^*)}{B(\alpha + x, \; \beta + n - x)},</span>
<span id="cb27-1182"><a href="#cb27-1182" aria-hidden="true" tabindex="-1"></a>\; x^* \in <span class="sc">\{</span>0, 1, \ldots, n^*<span class="sc">\}</span></span>
<span id="cb27-1183"><a href="#cb27-1183" aria-hidden="true" tabindex="-1"></a>\end{align}$$ another beta-binomial distribution.</span>
<span id="cb27-1184"><a href="#cb27-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1185"><a href="#cb27-1185" aria-hidden="true" tabindex="-1"></a>You can see that this is similar to @eq-marginal-distribution in that it shows the posterior predictive distribution as an average of conditional predictions over the posterior distribution of $\theta$. That is, it is equal to the conditional sampling density of $X^*$\theta averaged over all possible values of $\theta$ conditioned on our data.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>